# @uc/ez-snippet-cli é¡¹ç›®æ¶æ„åˆ†ææ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: `@uc/ez-snippet-cli`
**ç‰ˆæœ¬**: 0.4.3
**ä½œè€…**: Brandon Leon
**å®šä½**: åŸºäºæ¨¡æ¿çš„ä»£ç ç‰‡æ®µç”Ÿæˆå·¥å…·

è¿™æ˜¯ä¸€ä¸ªç”¨äºæ ¹æ®æä¾›çš„æ¨¡æ¿æ–‡ä»¶ï¼Œç®€å•ã€é«˜æ•ˆç”Ÿæˆæ¨¡æ¿ä»£ç çš„ Node.js å‘½ä»¤è¡Œå·¥å…·ã€‚æ”¯æŒé™æ€æ¨¡æ¿å’ŒåŠ¨æ€æ¨¡æ¿ä¸¤ç§æ¨¡å¼ï¼Œé€‚ç”¨äº monorepo é¡¹ç›®åˆå§‹åŒ–ã€ç»„ä»¶åº“æ­å»ºç­‰åœºæ™¯ã€‚

---

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·å…¥å£å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  CLI å…¥å£     â”‚           â”‚  Node API    â”‚                â”‚
â”‚  â”‚  (bin.ts)    â”‚           â”‚  (index.ts)  â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                          â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ ¸å¿ƒè°ƒåº¦å±‚                                â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚  entry() â”‚                              â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                              â”‚
â”‚                          â”‚                                   â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚         â–¼                                 â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ configInvoke â”‚               â”‚imperativeInvokeâ”‚          â”‚
â”‚  â”‚ (é…ç½®æ–‡ä»¶è°ƒç”¨) â”‚               â”‚ (å‘½ä»¤å¼è°ƒç”¨)   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                              â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç³»ç»Ÿæ”¯æŒå±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ read-cli-args  â”‚         â”‚  read-config   â”‚             â”‚
â”‚  â”‚ (å‘½ä»¤è¡Œå‚æ•°è§£æ) â”‚         â”‚  (é…ç½®æ–‡ä»¶è¯»å–) â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚  â”‚ schema-check   â”‚                                         â”‚
â”‚  â”‚ (é…ç½®æ ¡éªŒ)      â”‚                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¸šåŠ¡å¤„ç†å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  handleInput   â”‚         â”‚ outputTemplate â”‚             â”‚
â”‚  â”‚  (è¾“å…¥å¤„ç†)     â”‚  â”€â”€â”€â”€â–º  â”‚  (æ¨¡æ¿è¾“å‡º)     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â”‚                            â”‚                      â”‚
â”‚         â”‚ äº¤äº’å¼è¾“å…¥                  â”‚ æ–‡ä»¶ç”Ÿæˆ              â”‚
â”‚         â”‚ å˜é‡æ³¨å…¥                    â”‚ ç›®å½•åˆ›å»º              â”‚
â”‚         â”‚                            â”‚ æ¨¡æ¿ç¼–è¯‘              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å·¥å…·æ”¯æŒå±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  logger  â”‚  â”‚ checker  â”‚  â”‚parse-jsonâ”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ç›®å½•ç»“æ„è¯¦è§£

```
ez-snippet-cli/
â”œâ”€â”€ src/                          # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ bin.ts                    # CLI å‘½ä»¤è¡Œå…¥å£
â”‚   â”œâ”€â”€ entry.ts                  # æ ¸å¿ƒå…¥å£å‡½æ•°
â”‚   â”œâ”€â”€ index.ts                  # åº“å¯¼å‡ºå…¥å£ï¼ˆä¾› Node API è°ƒç”¨ï¼‰
â”‚   â”œâ”€â”€ interface.ts              # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ constants.ts              # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ define.ts                 # é…ç½®å®šä¹‰è¾…åŠ©å‡½æ•°
â”‚   â”œâ”€â”€ schema-check.ts           # Joi é…ç½®æ ¡éªŒ
â”‚   â”‚
â”‚   â”œâ”€â”€ invoke/                   # è°ƒç”¨å±‚
â”‚   â”‚   â”œâ”€â”€ config.ts             # åŸºäºé…ç½®æ–‡ä»¶çš„è°ƒç”¨é€»è¾‘
â”‚   â”‚   â””â”€â”€ imperative.ts         # åŸºäºå‘½ä»¤å¼çš„è°ƒç”¨é€»è¾‘
â”‚   â”‚
â”‚   â”œâ”€â”€ system/                   # ç³»ç»Ÿå±‚
â”‚   â”‚   â”œâ”€â”€ read-cli-args.ts      # å‘½ä»¤è¡Œå‚æ•°è§£æ
â”‚   â”‚   â””â”€â”€ read-config.ts        # é…ç½®æ–‡ä»¶è¯»å–ä¸è§£æ
â”‚   â”‚
â”‚   â”œâ”€â”€ consume/                  # ä¸šåŠ¡å¤„ç†å±‚
â”‚   â”‚   â”œâ”€â”€ input.ts              # è¾“å…¥å¤„ç†ï¼ˆäº¤äº’å¼è¾“å…¥ã€å˜é‡æ³¨å…¥ï¼‰
â”‚   â”‚   â””â”€â”€ output.ts             # è¾“å‡ºå¤„ç†ï¼ˆæ¨¡æ¿ç¼–è¯‘ã€æ–‡ä»¶ç”Ÿæˆï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ helper/                   # è¾…åŠ©å‡½æ•°
â”‚   â”‚   â””â”€â”€ generate-output-bydir.ts  # åŸºäºç›®å½•ç»“æ„ç”Ÿæˆé…ç½®
â”‚   â”‚
â”‚   â””â”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ log.ts                # æ—¥å¿—è¾“å‡º
â”‚       â”œâ”€â”€ checker.ts            # ç±»å‹æ£€æŸ¥å·¥å…·
â”‚       â””â”€â”€ parse-json.ts         # JSON è§£æï¼ˆæ”¯æŒæ³¨é‡Šï¼‰
â”‚
â”œâ”€â”€ template/                     # æ¨¡æ¿ç¤ºä¾‹
â”‚   â”œâ”€â”€ dynamic/                  # åŠ¨æ€æ¨¡æ¿ç¤ºä¾‹
â”‚   â”‚   â”œâ”€â”€ env.d.ts.tpl
â”‚   â”‚   â”œâ”€â”€ index.ts.tpl
â”‚   â”‚   â”œâ”€â”€ package.json.tpl
â”‚   â”‚   â””â”€â”€ README.md.tpl
â”‚   â””â”€â”€ static/                   # é™æ€æ¨¡æ¿ç¤ºä¾‹
â”‚       â””â”€â”€ tsconfig.json.tpl
â”‚
â”œâ”€â”€ dist/                         # ç¼–è¯‘è¾“å‡ºç›®å½•ï¼ˆæ„å»ºåï¼‰
â”‚   â”œâ”€â”€ bin.js                    # CLI å¯æ‰§è¡Œæ–‡ä»¶
â”‚   â”œâ”€â”€ index.js                  # åº“å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ *.d.ts                    # TypeScript ç±»å‹å£°æ˜
â”‚
â”œâ”€â”€ rollup.config.js              # Rollup æ‰“åŒ…é…ç½®
â”œâ”€â”€ tsconfig.json                 # TypeScript é…ç½®
â”œâ”€â”€ package.json                  # é¡¹ç›®é…ç½®
â”œâ”€â”€ ezs.config.js                 # ç¤ºä¾‹é…ç½®ï¼ˆJS æ ¼å¼ï¼‰
â””â”€â”€ ezs.config.json               # ç¤ºä¾‹é…ç½®ï¼ˆJSON æ ¼å¼ï¼‰
```

---

## ğŸ”§ æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. å…¥å£å±‚ (Entry Layer)

#### `bin.ts` - CLI å‘½ä»¤è¡Œå…¥å£
```typescript
import { entry } from "./entry"
entry()
```

- **èŒè´£**: ä½œä¸º CLI å·¥å…·çš„å¯åŠ¨ç‚¹
- **æ³¨å†Œæ–¹å¼**: é€šè¿‡ `package.json` çš„ `bin` å­—æ®µæ³¨å†Œä¸º `ezs` å‘½ä»¤
- **æ‰§è¡Œæµç¨‹**: ç›´æ¥è°ƒç”¨ `entry()` å‡½æ•°ï¼Œä¸ä¼ å‚æ•°è¡¨ç¤ºä½¿ç”¨é…ç½®æ–‡ä»¶æ¨¡å¼

#### `index.ts` - Node API å…¥å£
```typescript
export { entry as default } from "./entry"
export { defineConfig, defineWorkflow } from "./define"
export { generateOutputByDirStructureHelper } from "./helper/generate-output-bydir"
export type { UserConfig, UserOutputPair, InputOptions, OutputOptions } from "./interface"
```

- **èŒè´£**: å¯¼å‡ºå…¬å…± API ä¾›å…¶ä»–é¡¹ç›®ä»¥ç¼–ç¨‹æ–¹å¼è°ƒç”¨
- **å¯¼å‡ºå†…å®¹**:
  - `entry`: æ ¸å¿ƒå…¥å£å‡½æ•°
  - `defineConfig`: é…ç½®å®šä¹‰è¾…åŠ©å‡½æ•°ï¼ˆæä¾›ç±»å‹æç¤ºï¼‰
  - `defineWorkflow`: å·¥ä½œæµå®šä¹‰è¾…åŠ©å‡½æ•°
  - `generateOutputByDirStructureHelper`: åŸºäºç›®å½•ç»“æ„ç”Ÿæˆé…ç½®çš„è¾…åŠ©å‡½æ•°
  - ç±»å‹å®šä¹‰

---

### 2. æ ¸å¿ƒè°ƒåº¦å±‚ (Core Orchestration Layer)

#### `entry.ts` - æ ¸å¿ƒå…¥å£å‡½æ•°
```typescript
export async function entry(imperativeConfig?: WorkflowConfigWithName)
```

**èŒè´£**: ä½œä¸ºæ•´ä¸ªå·¥å…·çš„æ ¸å¿ƒè°ƒåº¦ä¸­å¿ƒ

**æ‰§è¡Œé€»è¾‘**:
1. æ‰“å°æ¬¢è¿ä¿¡æ¯
2. åˆ¤æ–­è°ƒç”¨æ–¹å¼ï¼š
   - å¦‚æœä¼ å…¥ `imperativeConfig` â†’ å‘½ä»¤å¼è°ƒç”¨ï¼ˆNode APIï¼‰
   - å¦‚æœæœªä¼ å…¥å‚æ•° â†’ é…ç½®æ–‡ä»¶è°ƒç”¨ï¼ˆCLIï¼‰
3. æ‰§è¡Œå¯¹åº”çš„è°ƒç”¨é€»è¾‘
4. è¾“å‡ºæ‰§è¡Œç»“æœ

**ä¼˜å…ˆçº§ç­–ç•¥**:
```
Node.js å‘½ä»¤å¼è°ƒç”¨ > å‘½ä»¤è¡Œå‚æ•° > é…ç½®æ–‡ä»¶
```

#### `invoke/config.ts` - é…ç½®æ–‡ä»¶è°ƒç”¨
**æ ¸å¿ƒæµç¨‹**:
```
1. è¯»å–å‘½ä»¤è¡Œå‚æ•°ï¼ˆ--config æˆ– -Cï¼‰
2. æœç´¢é…ç½®æ–‡ä»¶ï¼ˆezs.config.mjs > ezs.config.js > ezs.config.jsonï¼‰
3. è§£æé…ç½®æ–‡ä»¶ï¼ˆæ”¯æŒ JS/JSONï¼‰
4. æ ¡éªŒé…ç½®åˆæ³•æ€§ï¼ˆJoi schemaï¼‰
5. åŒ¹é…å·¥ä½œæµï¼ˆæ ¹æ®å‘½ä»¤è¡Œå‚æ•°ï¼‰
6. æ‰§è¡Œå·¥ä½œæµ
```

**å…³é”®å‡½æ•°**:
- `configInvoke()`: ä¸»å‡½æ•°
- ä¾èµ– `readConfigByPath()` è¯»å–é…ç½®
- ä¾èµ– `matchWorkflow()` åŒ¹é…å·¥ä½œæµ
- ä¾èµ– `handleInput()` å¤„ç†è¾“å…¥
- ä¾èµ– `outputTemplate()` ç”Ÿæˆè¾“å‡º

#### `invoke/imperative.ts` - å‘½ä»¤å¼è°ƒç”¨
**æ ¸å¿ƒæµç¨‹**:
```
1. æ¥æ”¶ WorkflowConfigWithName é…ç½®å¯¹è±¡
2. æ ¡éªŒé…ç½®åˆæ³•æ€§
3. å¤„ç†è¾“å…¥ï¼ˆäº¤äº’å¼è¾“å…¥ã€å˜é‡æ³¨å…¥ï¼‰
4. ç”Ÿæˆæ¨¡æ¿è¾“å‡º
```

**ä½¿ç”¨åœºæ™¯**: é€‚ç”¨äºåœ¨ Node.js è„šæœ¬ä¸­ç¼–ç¨‹å¼è°ƒç”¨

---

### 3. ç³»ç»Ÿæ”¯æŒå±‚ (System Support Layer)

#### `system/read-cli-args.ts` - å‘½ä»¤è¡Œå‚æ•°è§£æ
**ä½¿ç”¨åº“**: `minimist`

**è§£æå†…å®¹**:
- `process.argv.slice(2)`: è·å–å‘½ä»¤è¡Œå‚æ•°
- `cliArgs._`: å·¥ä½œæµåç§°ï¼ˆå¦‚ `ezs plugin` ä¸­çš„ `plugin`ï¼‰
- `cliArgs.config` æˆ– `cliArgs.C`: é…ç½®æ–‡ä»¶è·¯å¾„

**å…³é”®å‡½æ•°**:
- `matchWorkflow()`: åŒ¹é…å‘½ä»¤è¡Œå‚æ•°ä¸é…ç½®ä¸­çš„å·¥ä½œæµ
  - æ”¯æŒ camelCase è½¬æ¢ï¼ˆ`my-plugin` â†’ `myPlugin`ï¼‰
  - æ¨¡ç³ŠåŒ¹é…
- `getHighPriorityWorkflow()`: è·å–æœ€é«˜ä¼˜å…ˆçº§çš„å·¥ä½œæµï¼ˆå½“å‰å–ç¬¬ä¸€ä¸ªï¼‰

#### `system/read-config.ts` - é…ç½®æ–‡ä»¶è¯»å–
**æ”¯æŒæ ¼å¼**:
- `.mjs` / `.js`: JavaScript é…ç½®ï¼ˆæ”¯æŒåŠ¨æ€é€»è¾‘ï¼‰
- `.json`: JSON é…ç½®ï¼ˆæ”¯æŒæ³¨é‡Šï¼Œä½¿ç”¨ `comment-json`ï¼‰

**æ ¸å¿ƒæµç¨‹**:
```typescript
1. æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. æ ¹æ®æ–‡ä»¶ç±»å‹é€‰æ‹©è§£ææ–¹å¼ï¼š
   - JS: ä½¿ç”¨ import() åŠ¨æ€å¯¼å…¥
   - JSON: ä½¿ç”¨ comment-json è§£æ
3. è§£æ UserConfigï¼ˆå¯èƒ½æ˜¯å‡½æ•°ï¼‰
4. æ ¡éªŒé…ç½®åˆæ³•æ€§
5. å†»ç»“é…ç½®å¯¹è±¡ï¼ˆObject.freezeï¼‰
```

**å…³é”®å‡½æ•°**:
- `readConfigByPath()`: è¯»å–é…ç½®æ–‡ä»¶
- `readJsConfig()`: è§£æ JS é…ç½®
- `readJSONConfig()`: è§£æ JSON é…ç½®
- `resolveUserConfig()`: è§£æç”¨æˆ·é…ç½®ï¼ˆæ”¯æŒå‡½æ•°å½¢å¼ï¼‰

#### `schema-check.ts` - é…ç½®æ ¡éªŒ
**ä½¿ç”¨åº“**: `Joi`

**æ ¡éªŒè§„åˆ™**:
```typescript
// Prompt é€‰é¡¹
{
  description: string (optional)
  initialMeta: string (optional)
  required: boolean (optional)
}

// Input é€‰é¡¹
{
  prompt: PromptOptions | PromptOptions[] (optional)
  injectTemplateVars: function (optional)
}

// Output Pair
{
  templatePath: string (required)
  filename: string | function (required)
}

// Output Options
{
  dirname: string | function (required)
  pairs: OutputPair | OutputPair[] | function (required)
}

// Workflow
{
  input: InputOptions (optional)
  output: OutputOptions | OutputOptions[] (required)
  workflowName: string (optional)
}

// Config
{
  snippet: {
    [workflow: /^[a-zA-Z]+.*[a-zA-Z]+$/]: WorkflowConfig
  }
}
```

**å¯¼å‡ºå‡½æ•°**:
- `validateConfig()`: æ ¡éªŒå®Œæ•´é…ç½®
- `validateConfigWithLog()`: æ ¡éªŒé…ç½®å¹¶è¾“å‡ºæ—¥å¿—
- `validateWorkflowWithLog()`: æ ¡éªŒå·¥ä½œæµé…ç½®å¹¶è¾“å‡ºæ—¥å¿—

---

### 4. ä¸šåŠ¡å¤„ç†å±‚ (Business Logic Layer)

#### `consume/input.ts` - è¾“å…¥å¤„ç†
**æ ¸å¿ƒåŠŸèƒ½**: å¤„ç†ç”¨æˆ·äº¤äº’å¼è¾“å…¥å’Œå˜é‡æ³¨å…¥

**ä½¿ç”¨åº“**: `enquirer`ï¼ˆå‘½ä»¤è¡Œäº¤äº’ï¼‰

**å¤„ç†æµç¨‹**:
```typescript
1. æ£€æŸ¥æ˜¯å¦æœ‰ prompt é…ç½®
2. å¦‚æœæœ‰ï¼Œå¯åŠ¨äº¤äº’å¼è¾“å…¥ï¼š
   - æ”¯æŒå•ä¸ªæˆ–å¤šä¸ªè¾“å…¥
   - æ”¯æŒå¿…å¡«/å¯é€‰
   - æ”¯æŒåˆå§‹å€¼
   - æ”¯æŒè‡ªå®šä¹‰æè¿°
3. è·å–ç”¨æˆ·è¾“å…¥çš„ meta æ•°æ®
4. è°ƒç”¨ injectTemplateVars() å·¥å‚å‡½æ•°
5. è¿”å› { meta, injectVarsResult }
```

**å…³é”®å‡½æ•°**:
- `handleInput()`: ä¸»å‡½æ•°
- `getMetaByPrompt()`: è·å–äº¤äº’å¼è¾“å…¥

**è¿”å›å€¼**:
```typescript
{
  meta: string[]              // ç”¨æˆ·è¾“å…¥çš„åŸå§‹æ•°æ®
  injectVarsResult: object    // æ³¨å…¥åˆ°æ¨¡æ¿çš„å˜é‡å¯¹è±¡
}
```

#### `consume/output.ts` - è¾“å‡ºå¤„ç†
**æ ¸å¿ƒåŠŸèƒ½**: æ¨¡æ¿ç¼–è¯‘å’Œæ–‡ä»¶ç”Ÿæˆ

**ä½¿ç”¨åº“**:
- `lodash.template`: æ¨¡æ¿ç¼–è¯‘
- `fs-extra`: æ–‡ä»¶ç³»ç»Ÿæ“ä½œ

**å¤„ç†æµç¨‹**:
```typescript
1. æ ‡å‡†åŒ– output é…ç½®ï¼ˆè½¬ä¸ºæ•°ç»„ï¼‰
2. éå†æ¯ä¸ª output é…ç½®ï¼š
   a. è§£æ dirnameï¼ˆæ”¯æŒå‡½æ•°ï¼‰
   b. åˆ›å»ºç›®å½•ï¼ˆrecursive: trueï¼‰
   c. è§£æ pairsï¼ˆæ”¯æŒå‡½æ•°ï¼‰
   d. éå†æ¯ä¸ª pairï¼š
      - è¯»å–æ¨¡æ¿æ–‡ä»¶
      - ä½¿ç”¨ lodash.template ç¼–è¯‘
      - æ³¨å…¥å˜é‡
      - å†™å…¥è¾“å‡ºæ–‡ä»¶
3. è¿”å›æ‰§è¡Œç»“æœ
```

**å…³é”®å‡½æ•°**:
- `outputTemplate()`: ä¸»å‡½æ•°
- `resolveOutputPairs()`: è§£æè¾“å‡ºé…å¯¹å…³ç³»
- `outputTemplateByPath()`: æ ¹æ®è·¯å¾„è¾“å‡ºæ¨¡æ¿
- `createFile()`: åˆ›å»ºæ–‡ä»¶

**æ¨¡æ¿è¯­æ³•**: ä½¿ç”¨ [Lodash Template](https://lodash.com/docs/4.17.15#template)
```javascript
// æ’å€¼
<%= pluginName %>

// æ‰§è¡Œä»£ç 
<% if (condition) { %>
  ...
<% } %>

// HTML è½¬ä¹‰
<%- htmlString %>
```

---

### 5. è¾…åŠ©å‡½æ•°å±‚ (Helper Layer)

#### `helper/generate-output-bydir.ts` - åŸºäºç›®å½•ç»“æ„ç”Ÿæˆé…ç½®
**æ ¸å¿ƒåŠŸèƒ½**: æ ¹æ®å·²æœ‰æ–‡ä»¶ç›®å½•ç»“æ„è‡ªåŠ¨ç”Ÿæˆ output é…ç½®

**ä½¿ç”¨åœºæ™¯**:
- å½“æ¨¡æ¿æ–‡ä»¶å¾ˆå¤šæ—¶ï¼Œæ‰‹åŠ¨é…ç½® pairs ç¹ç
- å¸Œæœ›ä¿æŒæºç›®å½•ç»“æ„ä¸å˜ï¼Œç›´æ¥"æ‹·è´"åˆ°ç›®æ ‡ç›®å½•

**æ ¸å¿ƒç®—æ³•**:
```typescript
1. é€’å½’è¯»å–æºç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆDFSï¼‰
2. è®¡ç®—æ¯ä¸ªæ–‡ä»¶ç›¸å¯¹äºæºç›®å½•çš„ç›¸å¯¹è·¯å¾„
3. æŒ‰ç›¸å¯¹ç›®å½•è·¯å¾„åˆ†ç»„ï¼ˆä½¿ç”¨ Mapï¼‰
4. ä¸ºæ¯ä¸ªç›®å½•ç”Ÿæˆä¸€ä¸ª OutputOptionsï¼š
   - dirname: æ ¹æ®ç›¸å¯¹è·¯å¾„è®¡ç®—ç›®æ ‡ç›®å½•
   - pairs: è¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶
5. è¿”å› OutputOptions[]
```

**å…³é”®å‡½æ•°**:
- `generateOutputByDirStructureHelper()`: ä¸»å‡½æ•°
- `recursionReadFileInDir()`: é€’å½’è¯»å–ç›®å½•ï¼ˆDFSï¼‰
- `generateOutputHashMapByMeta()`: æŒ‰ç›®å½•åˆ†ç»„

**ä½¿ç”¨ç¤ºä¾‹**:
```javascript
import { generateOutputByDirStructureHelper } from "@uc/ez-snippet-cli"

output: generateOutputByDirStructureHelper("templates/react-app", {
  toDir: (sourceRelativePath, meta) => path.join("apps", meta, sourceRelativePath)
})
```

---

### 6. å·¥å…·æ”¯æŒå±‚ (Utility Layer)

#### `utils/log.ts` - æ—¥å¿—è¾“å‡º
**ä½¿ç”¨åº“**: `chalk`ï¼ˆç»ˆç«¯é¢œè‰²ï¼‰

**æ—¥å¿—çº§åˆ«**:
- `entryStep()`: å…¥å£æ¬¢è¿ä¿¡æ¯ï¼ˆç™½è‰²ï¼‰
- `logStep()`: æ™®é€šæ—¥å¿—ï¼ˆç™½è‰²ï¼‰
- `infoStep()`: ä¿¡æ¯æç¤ºï¼ˆé’è‰²ï¼‰
- `successStep()`: æˆåŠŸä¿¡æ¯ï¼ˆç»¿è‰²ï¼‰
- `warnStep()`: è­¦å‘Šä¿¡æ¯ï¼ˆé»„è‰²ï¼‰
- `errorStep()`: é”™è¯¯ä¿¡æ¯ï¼ˆçº¢è‰²ï¼‰

**æ ¼å¼**: `[@uc/ez-snippet-cli-{level}]: {message}`

#### `utils/checker.ts` - ç±»å‹æ£€æŸ¥å·¥å…·
**æä¾›å‡½æ•°**:
- `isJSFile()`: æ£€æŸ¥æ˜¯å¦ä¸º JS æ–‡ä»¶ï¼ˆ`.js` / `.mjs`ï¼‰
- `isJSONFile()`: æ£€æŸ¥æ˜¯å¦ä¸º JSON æ–‡ä»¶
- `isUndefined()`: æ£€æŸ¥æ˜¯å¦ä¸º undefinedï¼ˆç±»å‹å®ˆå«ï¼‰
- `isObject()`: æ£€æŸ¥æ˜¯å¦ä¸ºå¯¹è±¡ï¼ˆç±»å‹å®ˆå«ï¼‰
- `isValidString()`: æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆå­—ç¬¦ä¸²ï¼ˆéç©ºï¼‰

#### `utils/parse-json.ts` - JSON è§£æ
**ä½¿ç”¨åº“**: `comment-json`

**æ ¸å¿ƒåŠŸèƒ½**: æ”¯æŒè§£æå¸¦æ³¨é‡Šçš„ JSON æ–‡ä»¶

**å…³é”®å‡½æ•°**:
- `readAndParseJson()`: è¯»å–å¹¶è§£æ JSON æ–‡ä»¶

---

## ğŸ”„ æ ¸å¿ƒå·¥ä½œæµç¨‹

### åœºæ™¯ 1: CLI é™æ€æ¨¡æ¿ç”Ÿæˆ

```
ç”¨æˆ·æ‰§è¡Œå‘½ä»¤: ezs tsconfig --config=ezs.config.json
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. bin.ts å¯åŠ¨ï¼Œè°ƒç”¨ entry()                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. entry() æ£€æµ‹æ—  imperativeConfig           â”‚
â”‚    â†’ è°ƒç”¨ configInvoke()                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. read-cli-args è§£æå‘½ä»¤è¡Œå‚æ•°              â”‚
â”‚    - workflow: "tsconfig"                   â”‚
â”‚    - config: "ezs.config.json"              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. read-config è¯»å–é…ç½®æ–‡ä»¶                  â”‚
â”‚    - æœç´¢ ezs.config.json                   â”‚
â”‚    - è§£æ JSONï¼ˆæ”¯æŒæ³¨é‡Šï¼‰                   â”‚
â”‚    - æ ¡éªŒé…ç½®åˆæ³•æ€§                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. matchWorkflow() åŒ¹é…å·¥ä½œæµ                â”‚
â”‚    - æ‰¾åˆ° snippet.tsconfig é…ç½®              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. handleInput() å¤„ç†è¾“å…¥                    â”‚
â”‚    - é™æ€æ¨¡æ¿æ—  input é…ç½®                   â”‚
â”‚    - è¿”å›ç©º meta å’Œ injectVarsResult         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. outputTemplate() ç”Ÿæˆæ¨¡æ¿                 â”‚
â”‚    - åˆ›å»ºç›®å½•: example/config                â”‚
â”‚    - è¯»å–æ¨¡æ¿: template/static/tsconfig.json.tpl â”‚
â”‚    - ç¼–è¯‘æ¨¡æ¿ï¼ˆæ— å˜é‡æ³¨å…¥ï¼‰                   â”‚
â”‚    - å†™å…¥æ–‡ä»¶: example/config/tsconfig.common.json â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. è¾“å‡ºæˆåŠŸä¿¡æ¯                              â”‚
â”‚    âœ“ æ¨¡ç‰ˆåˆ›å»ºæˆåŠŸ                            â”‚
â”‚    âœ“ æ‰€æœ‰æ¨¡ç‰ˆç¼–è¯‘å®Œæˆï¼                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åœºæ™¯ 2: CLI åŠ¨æ€æ¨¡æ¿ç”Ÿæˆ

```
ç”¨æˆ·æ‰§è¡Œå‘½ä»¤: ezs plugin --config=ezs.config.js
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1-5. åŒé™æ€æ¨¡æ¿æµç¨‹                          â”‚
â”‚      æ‰¾åˆ° snippet.plugin é…ç½®                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. handleInput() å¤„ç†è¾“å…¥                    â”‚
â”‚    - æ£€æµ‹åˆ° input.prompt é…ç½®                â”‚
â”‚    - å¯åŠ¨äº¤äº’å¼è¾“å…¥                          â”‚
â”‚      âœ” è¯·è¾“å…¥éœ€è¦åˆå§‹åŒ–çš„æ’ä»¶åç§° Â· test-plugin â”‚
â”‚    - è°ƒç”¨ injectTemplateVars(meta)           â”‚
â”‚      meta = ["test-plugin"]                 â”‚
â”‚      è¿”å›: {                                 â”‚
â”‚        pluginName: "test-plugin",           â”‚
â”‚        camelBasePluginName: "testPlugin"    â”‚
â”‚      }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. outputTemplate() ç”Ÿæˆæ¨¡æ¿                 â”‚
â”‚    - éå† output æ•°ç»„ï¼ˆå¤šä¸ªç›®å½•ï¼‰             â”‚
â”‚                                              â”‚
â”‚    ç¬¬ä¸€ä¸ªç›®å½•:                                â”‚
â”‚    - dirname: example/plugins-test-plugin   â”‚
â”‚    - åˆ›å»º 3 ä¸ªæ–‡ä»¶:                          â”‚
â”‚      âœ“ env.d.ts                             â”‚
â”‚      âœ“ package.json (æ³¨å…¥ pluginName)       â”‚
â”‚      âœ“ README.md (æ³¨å…¥ pluginName)          â”‚
â”‚                                              â”‚
â”‚    ç¬¬äºŒä¸ªç›®å½•:                                â”‚
â”‚    - dirname: example/plugins-test-plugin/src â”‚
â”‚    - åˆ›å»º 1 ä¸ªæ–‡ä»¶:                          â”‚
â”‚      âœ“ index.ts (æ³¨å…¥ camelBasePluginName)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. è¾“å‡ºæˆåŠŸä¿¡æ¯                              â”‚
â”‚    âœ“ æ‰€æœ‰æ¨¡ç‰ˆç¼–è¯‘å®Œæˆï¼                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åœºæ™¯ 3: Node API ç¼–ç¨‹å¼è°ƒç”¨

```javascript
import ezs, { defineWorkflow } from "@uc/ez-snippet-cli"

const workflow = defineWorkflow({
  workflowName: "my-component",
  input: {
    prompt: {
      description: "è¯·è¾“å…¥ç»„ä»¶åç§°",
      initialMeta: "Button"
    },
    injectTemplateVars: (name) => ({
      componentName: name,
      fileName: name.toLowerCase()
    })
  },
  output: {
    dirname: (name) => `src/components/${name}`,
    pairs: [
      { templatePath: "templates/component.tsx.tpl", filename: "index.tsx" },
      { templatePath: "templates/style.css.tpl", filename: "style.css" }
    ]
  }
})

// è°ƒç”¨
await ezs(workflow)
```

**æ‰§è¡Œæµç¨‹**:
```
1. entry(workflow) æ¥æ”¶é…ç½®
2. æ£€æµ‹åˆ° imperativeConfig å­˜åœ¨
3. è°ƒç”¨ imperativeInvoke()
4. æ ¡éªŒé…ç½®åˆæ³•æ€§
5. handleInput() å¤„ç†è¾“å…¥
6. outputTemplate() ç”Ÿæˆæ¨¡æ¿
7. è¿”å›æ‰§è¡Œç»“æœ
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

### 1. é…ç½®çµæ´»æ€§

#### æ”¯æŒå¤šç§é…ç½®æ ¼å¼
- **JSON é…ç½®** (`ezs.config.json`): é€‚åˆç®€å•é™æ€é…ç½®
- **JavaScript é…ç½®** (`ezs.config.js` / `.mjs`): æ”¯æŒåŠ¨æ€é€»è¾‘ã€å‡½æ•°ã€å¯¼å…¥å¤–éƒ¨æ¨¡å—

#### é…ç½®å¯ä»¥æ˜¯å‡½æ•°
```javascript
// æ”¯æŒåŒæ­¥å‡½æ•°
export default () => ({
  snippet: { ... }
})

// æ”¯æŒå¼‚æ­¥å‡½æ•°
export default async () => {
  const data = await fetchSomeData()
  return {
    snippet: { ... }
  }
}
```

### 2. åŠ¨æ€æ¨¡æ¿èƒ½åŠ›

#### Lodash æ¨¡æ¿è¯­æ³•
```javascript
// å˜é‡æ’å€¼
<%= variableName %>

// æ‰§è¡Œä»£ç 
<% if (condition) { %>
  conditional content
<% } %>

// å¾ªç¯
<% items.forEach(item => { %>
  - <%= item %>
<% }) %>
```

#### å˜é‡æ³¨å…¥å·¥å‚å‡½æ•°
```javascript
injectTemplateVars: (meta) => {
  return {
    pluginName: meta,
    camelCaseName: camelCase(meta),
    upperCaseName: meta.toUpperCase(),
    timestamp: Date.now()
  }
}
```

### 3. äº¤äº’å¼è¾“å…¥

#### å•ä¸ªè¾“å…¥
```javascript
input: {
  prompt: {
    description: "è¯·è¾“å…¥æ’ä»¶åç§°",
    initialMeta: "my-plugin",
    required: true
  }
}
```

#### å¤šä¸ªè¾“å…¥
```javascript
input: {
  prompt: [
    { description: "è¯·è¾“å…¥é¡¹ç›®åç§°", initialMeta: "my-project" },
    { description: "è¯·è¾“å…¥ä½œè€…åç§°", initialMeta: "John Doe" }
  ],
  injectTemplateVars: (projectName, authorName) => ({
    projectName,
    authorName
  })
}
```

### 4. çµæ´»çš„è¾“å‡ºé…ç½®

#### å•æ–‡ä»¶è¾“å‡º
```javascript
output: {
  dirname: "src/config",
  pairs: {
    templatePath: "template/config.json.tpl",
    filename: "config.json"
  }
}
```

#### å¤šæ–‡ä»¶è¾“å‡ºï¼ˆåŒä¸€ç›®å½•ï¼‰
```javascript
output: {
  dirname: "src/components/Button",
  pairs: [
    { templatePath: "templates/index.tsx.tpl", filename: "index.tsx" },
    { templatePath: "templates/style.css.tpl", filename: "style.css" },
    { templatePath: "templates/test.spec.tsx.tpl", filename: "test.spec.tsx" }
  ]
}
```

#### å¤šç›®å½•è¾“å‡º
```javascript
output: [
  {
    dirname: "src/components/Button",
    pairs: [
      { templatePath: "templates/index.tsx.tpl", filename: "index.tsx" },
      { templatePath: "templates/style.css.tpl", filename: "style.css" }
    ]
  },
  {
    dirname: "docs/components",
    pairs: {
      templatePath: "templates/README.md.tpl",
      filename: "Button.md"
    }
  }
]
```

#### åŠ¨æ€ç›®å½•å’Œæ–‡ä»¶å
```javascript
output: {
  dirname: (pluginName) => `packages/${pluginName}`,
  pairs: {
    templatePath: "templates/index.ts.tpl",
    filename: (pluginName) => `${pluginName}.ts`
  }
}
```

### 5. åŸºäºç›®å½•ç»“æ„çš„è¾…åŠ©å‡½æ•°

```javascript
import { generateOutputByDirStructureHelper } from "@uc/ez-snippet-cli"

output: generateOutputByDirStructureHelper("templates/react-app", {
  toDir: (sourceRelativePath, meta) => {
    return path.join("apps", meta, sourceRelativePath)
  },
  filenameFormatter: (originFilename) => {
    // å»æ‰ .tpl åç¼€
    return originFilename.replace(/\.tpl$/, "")
  }
})
```

**æ•ˆæœ**:
```
templates/react-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ App.tsx.tpl
â”‚   â””â”€â”€ index.tsx.tpl
â””â”€â”€ package.json.tpl

â†’ ç”Ÿæˆåˆ° â†’

apps/my-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ App.tsx
â”‚   â””â”€â”€ index.tsx
â””â”€â”€ package.json
```

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒä¾èµ–

| ä¾èµ– | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| `chalk` | ^4.0.0 | ç»ˆç«¯é¢œè‰²è¾“å‡º |
| `comment-json` | ^4.2.3 | è§£æå¸¦æ³¨é‡Šçš„ JSON |
| `enquirer` | ^2.3.6 | å‘½ä»¤è¡Œäº¤äº’å¼è¾“å…¥ |
| `fs-extra` | ^11.1.1 | æ–‡ä»¶ç³»ç»Ÿæ“ä½œå¢å¼º |
| `joi` | ^17.9.1 | é…ç½®æ ¡éªŒ |
| `lodash.camelcase` | ^4.3.0 | é©¼å³°å‘½åè½¬æ¢ |
| `lodash.template` | ^4.0.0 | æ¨¡æ¿ç¼–è¯‘ |
| `minimist` | ^1.2.8 | å‘½ä»¤è¡Œå‚æ•°è§£æ |

### å¼€å‘ä¾èµ–

| ä¾èµ– | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| `typescript` | ^5.0.2 | TypeScript ç¼–è¯‘ |
| `rollup` | ^3.20.2 | æ‰“åŒ…å·¥å…· |
| `@rollup/plugin-typescript` | ^11.0.0 | Rollup TS æ’ä»¶ |
| `@rollup/plugin-node-resolve` | ^15.0.1 | æ¨¡å—è§£æ |
| `rollup-plugin-delete` | ^2.0.0 | æ¸…ç†è¾“å‡ºç›®å½• |
| `eslint` | ^8.29.0 | ä»£ç æ£€æŸ¥ |
| `prettier` | ^2.8.7 | ä»£ç æ ¼å¼åŒ– |
| `release-it` | ^15.9.3 | ç‰ˆæœ¬å‘å¸ƒ |

---

## ğŸ“¦ æ„å»ºæµç¨‹

### Rollup é…ç½®è§£æ

```javascript
// rollup.config.js
export default {
  input: [
    path.resolve(cwd, "src/bin.ts"),    // CLI å…¥å£
    path.resolve(cwd, "src/index.ts")   // åº“å…¥å£
  ],
  external: [/[\//]node_modules[\//]/], // æ’é™¤ node_modules
  output: {
    format: "esm",                       // ES Module æ ¼å¼
    dir: "dist"                          // è¾“å‡ºåˆ° dist ç›®å½•
  },
  plugins: [
    typescript(),                        // TypeScript ç¼–è¯‘
    resolve(),                           // æ¨¡å—è§£æ
    del({ targets: 'dist/*' })          // æ¸…ç† dist ç›®å½•
  ]
}
```

### æ„å»ºäº§ç‰©

```
dist/
â”œâ”€â”€ bin.js                  # CLI å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ bin.d.ts                # CLI ç±»å‹å£°æ˜
â”œâ”€â”€ index.js                # åº“å…¥å£æ–‡ä»¶
â”œâ”€â”€ index.d.ts              # åº“ç±»å‹å£°æ˜
â”œâ”€â”€ entry.js / entry.d.ts
â”œâ”€â”€ define.js / define.d.ts
â”œâ”€â”€ interface.d.ts
â”œâ”€â”€ constants.js / constants.d.ts
â”œâ”€â”€ schema-check.js / schema-check.d.ts
â”œâ”€â”€ invoke/
â”‚   â”œâ”€â”€ config.js / config.d.ts
â”‚   â””â”€â”€ imperative.js / imperative.d.ts
â”œâ”€â”€ system/
â”‚   â”œâ”€â”€ read-cli-args.js / read-cli-args.d.ts
â”‚   â””â”€â”€ read-config.js / read-config.d.ts
â”œâ”€â”€ consume/
â”‚   â”œâ”€â”€ input.js / input.d.ts
â”‚   â””â”€â”€ output.js / output.d.ts
â”œâ”€â”€ helper/
â”‚   â””â”€â”€ generate-output-bydir.js / generate-output-bydir.d.ts
â””â”€â”€ utils/
    â”œâ”€â”€ log.js / log.d.ts
    â”œâ”€â”€ checker.js / checker.d.ts
    â””â”€â”€ parse-json.js / parse-json.d.ts
```

### NPM Scripts

```json
{
  "scripts": {
    "lint": "eslint src/ && tsc --noEmit",           // ä»£ç æ£€æŸ¥
    "build": "pnpm lint && rollup --config",         // æ„å»º
    "dev": "rollup --config --watch",                // å¼€å‘æ¨¡å¼ï¼ˆç›‘å¬ï¼‰
    "release": "pnpm build && release-it",           // å‘å¸ƒç‰ˆæœ¬
    "output:static": "node dist/bin.js --config=ezs.config.json tsconfig",  // æµ‹è¯•é™æ€æ¨¡æ¿
    "output:dynamic": "node dist/bin.js --config=ezs.config.js plugin"      // æµ‹è¯•åŠ¨æ€æ¨¡æ¿
  }
}
```

---

## ğŸ¨ è®¾è®¡æ¨¡å¼ä¸æœ€ä½³å®è·µ

### 1. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)
- **åœºæ™¯**: é…ç½®æ–‡ä»¶è°ƒç”¨ vs å‘½ä»¤å¼è°ƒç”¨
- **å®ç°**: `configInvoke()` å’Œ `imperativeInvoke()` ä¸¤ç§ç­–ç•¥
- **ä¼˜åŠ¿**: çµæ´»æ”¯æŒä¸åŒçš„è°ƒç”¨æ–¹å¼

### 2. å·¥å‚æ¨¡å¼ (Factory Pattern)
- **åœºæ™¯**: `injectTemplateVars` å·¥å‚å‡½æ•°
- **å®ç°**: æ ¹æ®ç”¨æˆ·è¾“å…¥åŠ¨æ€ç”Ÿæˆæ¨¡æ¿å˜é‡
- **ä¼˜åŠ¿**: è§£è€¦è¾“å…¥å’Œå˜é‡ç”Ÿæˆé€»è¾‘

### 3. æ¨¡æ¿æ–¹æ³•æ¨¡å¼ (Template Method Pattern)
- **åœºæ™¯**: æ¨¡æ¿ç¼–è¯‘æµç¨‹
- **å®ç°**: `outputTemplate()` å®šä¹‰æ ‡å‡†æµç¨‹ï¼Œå…·ä½“é€»è¾‘ç”±é…ç½®å†³å®š
- **ä¼˜åŠ¿**: ç»Ÿä¸€å¤„ç†æµç¨‹ï¼Œçµæ´»æ‰©å±•

### 4. èŒè´£é“¾æ¨¡å¼ (Chain of Responsibility)
- **åœºæ™¯**: é…ç½®æ–‡ä»¶æœç´¢
- **å®ç°**: æŒ‰ä¼˜å…ˆçº§æœç´¢ `.mjs` â†’ `.js` â†’ `.json`
- **ä¼˜åŠ¿**: çµæ´»çš„é…ç½®æ–‡ä»¶æŸ¥æ‰¾æœºåˆ¶

### 5. å•ä¸€èŒè´£åŸåˆ™ (SRP)
- æ¯ä¸ªæ¨¡å—èŒè´£æ˜ç¡®ï¼š
  - `read-cli-args`: åªè´Ÿè´£è§£æå‘½ä»¤è¡Œå‚æ•°
  - `read-config`: åªè´Ÿè´£è¯»å–é…ç½®æ–‡ä»¶
  - `handleInput`: åªè´Ÿè´£å¤„ç†è¾“å…¥
  - `outputTemplate`: åªè´Ÿè´£ç”Ÿæˆè¾“å‡º

### 6. ä¾èµ–å€’ç½®åŸåˆ™ (DIP)
- é«˜å±‚æ¨¡å—ï¼ˆ`entry`ï¼‰ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼ˆ`fs-extra`ï¼‰
- é€šè¿‡æŠ½è±¡å±‚ï¼ˆ`handleInput`, `outputTemplate`ï¼‰è§£è€¦

### 7. å¼€é—­åŸåˆ™ (OCP)
- å¯¹æ‰©å±•å¼€æ”¾ï¼š
  - å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„æ¨¡æ¿ç±»å‹
  - å¯ä»¥æ‰©å±•æ–°çš„è¾“å…¥æ–¹å¼
- å¯¹ä¿®æ”¹å°é—­ï¼š
  - æ ¸å¿ƒæµç¨‹ç¨³å®šï¼Œä¸éœ€è¦ä¿®æ”¹

### 8. ç±»å‹å®‰å…¨
- å…¨é¢ä½¿ç”¨ TypeScript
- å¯¼å‡ºç±»å‹å®šä¹‰ä¾›ç”¨æˆ·ä½¿ç”¨
- Joi schema è¿è¡Œæ—¶æ ¡éªŒ

### 9. é”™è¯¯å¤„ç†
- ç»Ÿä¸€çš„é”™è¯¯æ—¥å¿—è¾“å‡º
- æ¸…æ™°çš„é”™è¯¯æç¤º
- ä¼˜é›…çš„é”™è¯¯é€€å‡ºï¼ˆ`process.exit(exitCode)`ï¼‰

### 10. ä¸å¯å˜æ€§
- é…ç½®å¯¹è±¡ä½¿ç”¨ `Object.freeze()` å†»ç»“
- é¿å…æ„å¤–ä¿®æ”¹é…ç½®

---

## ğŸš€ ä½¿ç”¨åœºæ™¯

### 1. Monorepo é¡¹ç›®åˆå§‹åŒ–
```javascript
// å¿«é€Ÿåˆ›å»ºæ–°çš„åŒ…
ezs create-package
// è¾“å…¥åŒ…å â†’ è‡ªåŠ¨ç”Ÿæˆ package.json, tsconfig.json, src/index.ts ç­‰
```

### 2. ç»„ä»¶åº“æ­å»º
```javascript
// å¿«é€Ÿåˆ›å»ºæ–°ç»„ä»¶
ezs create-component
// è¾“å…¥ç»„ä»¶å â†’ è‡ªåŠ¨ç”Ÿæˆç»„ä»¶æ–‡ä»¶ã€æ ·å¼æ–‡ä»¶ã€æµ‹è¯•æ–‡ä»¶ã€æ–‡æ¡£
```

### 3. æ’ä»¶ç³»ç»Ÿåˆå§‹åŒ–
```javascript
// å¿«é€Ÿåˆ›å»ºæ–°æ’ä»¶
ezs create-plugin
// è¾“å…¥æ’ä»¶å â†’ è‡ªåŠ¨ç”Ÿæˆæ’ä»¶éª¨æ¶ä»£ç 
```

### 4. é¡¹ç›®è„šæ‰‹æ¶
```javascript
// å¿«é€Ÿåˆ›å»ºæ–°é¡¹ç›®
ezs create-project
// é€‰æ‹©é¡¹ç›®ç±»å‹ â†’ è‡ªåŠ¨ç”Ÿæˆå®Œæ•´é¡¹ç›®ç»“æ„
```

### 5. é…ç½®æ–‡ä»¶ç”Ÿæˆ
```javascript
// å¿«é€Ÿç”Ÿæˆæ ‡å‡†é…ç½®æ–‡ä»¶
ezs generate-config
// è‡ªåŠ¨ç”Ÿæˆ tsconfig.json, eslint.config.js ç­‰
```

---

## ğŸ“Š ä¼˜åŠ¿ä¸ç‰¹ç‚¹

### âœ… ä¼˜åŠ¿

1. **è½»é‡çº§**: æ ¸å¿ƒä»£ç ç®€æ´ï¼Œä¾èµ–å°‘
2. **çµæ´»æ€§**: æ”¯æŒé™æ€/åŠ¨æ€æ¨¡æ¿ã€å¤šç§é…ç½®æ ¼å¼
3. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript æ”¯æŒ
4. **æ˜“ç”¨æ€§**: ç®€å•çš„ API è®¾è®¡ï¼Œæ¸…æ™°çš„æ–‡æ¡£
5. **å¯æ‰©å±•**: è‰¯å¥½çš„æ¶æ„è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
6. **äº¤äº’å‹å¥½**: å½©è‰²æ—¥å¿—è¾“å‡ºï¼Œäº¤äº’å¼è¾“å…¥
7. **é…ç½®æ ¡éªŒ**: Joi schema ç¡®ä¿é…ç½®åˆæ³•æ€§

### ğŸ¯ ç‰¹ç‚¹

1. **åŒæ¨¡å¼æ”¯æŒ**: CLI + Node API
2. **å¤šé…ç½®æ ¼å¼**: JSON / JavaScript
3. **åŠ¨æ€æ¨¡æ¿**: Lodash template è¯­æ³•
4. **äº¤äº’å¼è¾“å…¥**: Enquirer æ”¯æŒ
5. **ç›®å½•è¾…åŠ©å‡½æ•°**: åŸºäºç›®å½•ç»“æ„è‡ªåŠ¨ç”Ÿæˆé…ç½®
6. **æ¨¡ç³ŠåŒ¹é…**: æ”¯æŒ camelCase å·¥ä½œæµåç§°åŒ¹é…

---

## ğŸ”® å¯èƒ½çš„æ”¹è¿›æ–¹å‘

### 1. åŠŸèƒ½å¢å¼º
- [ ] æ”¯æŒæ¨¡æ¿ç»§æ‰¿å’Œç»„åˆ
- [ ] æ”¯æŒæ¨¡æ¿å¸‚åœº/æ¨¡æ¿ä»“åº“
- [ ] æ”¯æŒè¿œç¨‹æ¨¡æ¿ï¼ˆä» Git ä»“åº“æ‹‰å–ï¼‰
- [ ] æ”¯æŒæ¨¡æ¿é¢„è§ˆï¼ˆdry-run æ¨¡å¼ï¼‰
- [ ] æ”¯æŒæ¨¡æ¿å›æ»š

### 2. æ€§èƒ½ä¼˜åŒ–
- [ ] å¤šçº¿ç¨‹å¹¶è¡Œç”Ÿæˆæ¨¡æ¿
- [ ] æ¨¡æ¿ç¼“å­˜æœºåˆ¶
- [ ] å¢é‡æ›´æ–°æ”¯æŒ

### 3. å¼€å‘ä½“éªŒ
- [ ] æ›´ä¸°å¯Œçš„æ¨¡æ¿ç¤ºä¾‹
- [ ] å¯è§†åŒ–é…ç½®ç”Ÿæˆå™¨
- [ ] VSCode æ’ä»¶æ”¯æŒ
- [ ] é…ç½®æ–‡ä»¶è‡ªåŠ¨è¡¥å…¨

### 4. æµ‹è¯•ä¸è´¨é‡
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–
- [ ] é›†æˆæµ‹è¯•
- [ ] E2E æµ‹è¯•
- [ ] CI/CD é›†æˆ

### 5. æ–‡æ¡£ä¸ç”Ÿæ€
- [ ] è‹±æ–‡æ–‡æ¡£
- [ ] è§†é¢‘æ•™ç¨‹
- [ ] ç¤¾åŒºæ¨¡æ¿åº“
- [ ] æœ€ä½³å®è·µæŒ‡å—

---

## ğŸ“ æ€»ç»“

`@uc/ez-snippet-cli` æ˜¯ä¸€ä¸ªè®¾è®¡è‰¯å¥½ã€åŠŸèƒ½å®Œå–„çš„æ¨¡æ¿ä»£ç ç”Ÿæˆå·¥å…·ã€‚å®ƒé€šè¿‡æ¸…æ™°çš„åˆ†å±‚æ¶æ„ã€çµæ´»çš„é…ç½®ç³»ç»Ÿå’Œå¼ºå¤§çš„æ¨¡æ¿å¼•æ“ï¼Œä¸ºå¼€å‘è€…æä¾›äº†é«˜æ•ˆçš„ä»£ç ç”Ÿæˆè§£å†³æ–¹æ¡ˆã€‚

**æ ¸å¿ƒä»·å€¼**:
- å‡å°‘é‡å¤åŠ³åŠ¨
- ç»Ÿä¸€ä»£ç é£æ ¼
- åŠ é€Ÿé¡¹ç›®æ­å»º
- æå‡å¼€å‘æ•ˆç‡

**é€‚ç”¨å›¢é˜Ÿ**:
- éœ€è¦å¿«é€Ÿæ­å»ºé¡¹ç›®çš„å›¢é˜Ÿ
- ç»´æŠ¤ Monorepo çš„å›¢é˜Ÿ
- å¼€å‘ç»„ä»¶åº“/æ’ä»¶ç³»ç»Ÿçš„å›¢é˜Ÿ
- è¿½æ±‚ä»£ç è§„èŒƒç»Ÿä¸€çš„å›¢é˜Ÿ

---

## ğŸ“š å‚è€ƒèµ„æº

- [Lodash Template æ–‡æ¡£](https://lodash.com/docs/4.17.15#template)
- [Enquirer æ–‡æ¡£](https://github.com/enquirer/enquirer)
- [Joi æ–‡æ¡£](https://joi.dev/)
- [Rollup æ–‡æ¡£](https://rollupjs.org/)
- [TypeScript æ–‡æ¡£](https://www.typescriptlang.org/)

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2025-12-18
**é¡¹ç›®ç‰ˆæœ¬**: 0.4.3
**æ–‡æ¡£ä½œè€…**: AI Assistant

