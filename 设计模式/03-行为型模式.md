# ç¬¬ä¸‰éƒ¨åˆ†ï¼šè¡Œä¸ºå‹æ¨¡å¼

> è¡Œä¸ºå‹æ¨¡å¼å…³æ³¨å¯¹è±¡ä¹‹é—´çš„é€šä¿¡ï¼Œå¸®åŠ©ä½ å®ç°æ›´çµæ´»çš„äº¤äº’é€»è¾‘

## ç›®å½•
- [è§‚å¯Ÿè€…æ¨¡å¼ (Observer)](#è§‚å¯Ÿè€…æ¨¡å¼)
- [ç­–ç•¥æ¨¡å¼ (Strategy)](#ç­–ç•¥æ¨¡å¼)
- [å‘½ä»¤æ¨¡å¼ (Command)](#å‘½ä»¤æ¨¡å¼)
- [çŠ¶æ€æ¨¡å¼ (State)](#çŠ¶æ€æ¨¡å¼)

---

## è§‚å¯Ÿè€…æ¨¡å¼

### ğŸ’¡ æ¨¡å¼å®šä¹‰
è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰å®šä¹‰å¯¹è±¡é—´çš„ä¸€å¯¹å¤šä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½ä¼šå¾—åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°ã€‚

### ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ

#### é—®é¢˜åœºæ™¯ï¼šå¤šä¸ªç»„ä»¶éœ€è¦å“åº”åŒä¸€ä¸ªæ•°æ®å˜åŒ–

å‡è®¾ä½ çš„ç”µå•†åº”ç”¨æœ‰è´­ç‰©è½¦åŠŸèƒ½ï¼Œå½“è´­ç‰©è½¦å•†å“æ•°é‡å˜åŒ–æ—¶ï¼Œéœ€è¦æ›´æ–°å¤šä¸ªåœ°æ–¹ï¼š

#### âŒ ä¸ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼çš„ç—›ç‚¹

```javascript
// CartManager.js - è´­ç‰©è½¦ç®¡ç†å™¨
class CartManager {
  constructor() {
    this.items = [];
  }

  addItem(item) {
    this.items.push(item);

    // è€¦åˆï¼šç›´æ¥è°ƒç”¨å„ä¸ªç»„ä»¶çš„æ›´æ–°æ–¹æ³•
    updateCartBadge(this.items.length);
    updateCartSidebar(this.items);
    updateCheckoutButton(this.items.length > 0);
    updateTotalPrice(this.calculateTotal());

    // æ¯æ¬¡æ·»åŠ æ–°åŠŸèƒ½éƒ½è¦ä¿®æ”¹è¿™é‡Œï¼
    // updateRecommendations(this.items);
    // updateCouponHints(this.items);
  }

  removeItem(itemId) {
    this.items = this.items.filter(item => item.id !== itemId);

    // åˆè¦é‡å¤è°ƒç”¨æ‰€æœ‰æ›´æ–°æ–¹æ³•
    updateCartBadge(this.items.length);
    updateCartSidebar(this.items);
    updateCheckoutButton(this.items.length > 0);
    updateTotalPrice(this.calculateTotal());
  }

  calculateTotal() {
    return this.items.reduce((sum, item) => sum + item.price * item.quantity, 0);
  }
}

// å„ä¸ªç‹¬ç«‹çš„æ›´æ–°å‡½æ•°
function updateCartBadge(count) {
  document.querySelector('.cart-badge').textContent = count;
}

function updateCartSidebar(items) {
  // æ›´æ–°ä¾§è¾¹æ 
}

function updateCheckoutButton(enabled) {
  document.querySelector('.checkout-btn').disabled = !enabled;
}

function updateTotalPrice(total) {
  document.querySelector('.total-price').textContent = `Â¥${total}`;
}
```

**é—®é¢˜**ï¼š
- ç´§è€¦åˆï¼šCartManager å¿…é¡»çŸ¥é“æ‰€æœ‰éœ€è¦æ›´æ–°çš„ç»„ä»¶
- éš¾ä»¥æ‰©å±•ï¼šæ–°å¢åŠŸèƒ½éœ€è¦ä¿®æ”¹ CartManager
- éš¾ä»¥ç»´æŠ¤ï¼šä¸€ä¸ªåœ°æ–¹æ”¹åŠ¨å¯èƒ½å½±å“å¤šä¸ªåŠŸèƒ½
- è¿åå•ä¸€èŒè´£ï¼šCartManager æ—¢ç®¡ç†æ•°æ®åˆè´Ÿè´£é€šçŸ¥

---

#### âœ… ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼è§£å†³

```javascript
// EventEmitter.js - äº‹ä»¶å‘å°„å™¨ï¼ˆè§‚å¯Ÿè€…æ¨¡å¼å®ç°ï¼‰
class EventEmitter {
  constructor() {
    this.events = new Map();
  }

  // è®¢é˜…äº‹ä»¶ï¼ˆæ³¨å†Œè§‚å¯Ÿè€…ï¼‰
  on(event, listener) {
    if (!this.events.has(event)) {
      this.events.set(event, []);
    }
    this.events.get(event).push(listener);

    // è¿”å›å–æ¶ˆè®¢é˜…å‡½æ•°
    return () => this.off(event, listener);
  }

  // å–æ¶ˆè®¢é˜…
  off(event, listener) {
    if (!this.events.has(event)) return;

    const listeners = this.events.get(event);
    const index = listeners.indexOf(listener);
    if (index > -1) {
      listeners.splice(index, 1);
    }
  }

  // è§¦å‘äº‹ä»¶ï¼ˆé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…ï¼‰
  emit(event, ...args) {
    if (!this.events.has(event)) return;

    const listeners = this.events.get(event);
    listeners.forEach(listener => {
      try {
        listener(...args);
      } catch (error) {
        console.error(`Error in event listener for ${event}:`, error);
      }
    });
  }

  // å•æ¬¡è®¢é˜…
  once(event, listener) {
    const onceWrapper = (...args) => {
      listener(...args);
      this.off(event, onceWrapper);
    };
    this.on(event, onceWrapper);
  }
}

export default EventEmitter;
```

```javascript
// CartManager.js - è´­ç‰©è½¦ç®¡ç†å™¨ï¼ˆå‘å¸ƒè€…ï¼‰
import EventEmitter from './EventEmitter';

class CartManager extends EventEmitter {
  constructor() {
    super();
    this.items = [];
  }

  addItem(item) {
    this.items.push(item);

    // åªè´Ÿè´£å‘å¸ƒäº‹ä»¶ï¼Œä¸å…³å¿ƒè°åœ¨ç›‘å¬
    this.emit('itemAdded', item);
    this.emit('cartChanged', this.items);
  }

  removeItem(itemId) {
    const removedItem = this.items.find(item => item.id === itemId);
    this.items = this.items.filter(item => item.id !== itemId);

    this.emit('itemRemoved', removedItem);
    this.emit('cartChanged', this.items);
  }

  updateQuantity(itemId, quantity) {
    const item = this.items.find(item => item.id === itemId);
    if (item) {
      item.quantity = quantity;
      this.emit('quantityChanged', item);
      this.emit('cartChanged', this.items);
    }
  }

  clear() {
    this.items = [];
    this.emit('cartCleared');
    this.emit('cartChanged', this.items);
  }

  getItems() {
    return this.items;
  }

  calculateTotal() {
    return this.items.reduce((sum, item) => sum + item.price * item.quantity, 0);
  }
}

export default new CartManager();
```

```javascript
// CartBadge.jsx - è´­ç‰©è½¦å¾½ç« ç»„ä»¶ï¼ˆè§‚å¯Ÿè€…ï¼‰
import React from 'react';
import cartManager from './CartManager';

function CartBadge() {
  const [count, setCount] = React.useState(cartManager.getItems().length);

  React.useEffect(() => {
    // è®¢é˜…è´­ç‰©è½¦å˜åŒ–
    const unsubscribe = cartManager.on('cartChanged', (items) => {
      setCount(items.length);
    });

    // æ¸…ç†è®¢é˜…
    return unsubscribe;
  }, []);

  return (
    <div className="cart-badge">
      <span className="icon">ğŸ›’</span>
      {count > 0 && <span className="count">{count}</span>}
    </div>
  );
}

export default CartBadge;
```

```javascript
// CartSidebar.jsx - è´­ç‰©è½¦ä¾§è¾¹æ ç»„ä»¶ï¼ˆè§‚å¯Ÿè€…ï¼‰
import React from 'react';
import cartManager from './CartManager';

function CartSidebar() {
  const [items, setItems] = React.useState(cartManager.getItems());
  const [total, setTotal] = React.useState(cartManager.calculateTotal());

  React.useEffect(() => {
    const unsubscribe = cartManager.on('cartChanged', (newItems) => {
      setItems(newItems);
      setTotal(cartManager.calculateTotal());
    });

    return unsubscribe;
  }, []);

  return (
    <div className="cart-sidebar">
      <h3>è´­ç‰©è½¦</h3>
      {items.length === 0 ? (
        <p>è´­ç‰©è½¦æ˜¯ç©ºçš„</p>
      ) : (
        <>
          <ul>
            {items.map(item => (
              <li key={item.id}>
                {item.name} x {item.quantity} - Â¥{item.price * item.quantity}
                <button onClick={() => cartManager.removeItem(item.id)}>åˆ é™¤</button>
              </li>
            ))}
          </ul>
          <div className="total">æ€»è®¡: Â¥{total}</div>
          <button className="checkout-btn">å»ç»“ç®—</button>
        </>
      )}
    </div>
  );
}

export default CartSidebar;
```

```javascript
// ProductCard.jsx - å•†å“å¡ç‰‡ç»„ä»¶
import React from 'react';
import cartManager from './CartManager';

function ProductCard({ product }) {
  const handleAddToCart = () => {
    cartManager.addItem({
      id: product.id,
      name: product.name,
      price: product.price,
      quantity: 1,
    });
  };

  return (
    <div className="product-card">
      <h4>{product.name}</h4>
      <p>Â¥{product.price}</p>
      <button onClick={handleAddToCart}>åŠ å…¥è´­ç‰©è½¦</button>
    </div>
  );
}

export default ProductCard;
```

```javascript
// Analytics.js - æ•°æ®åˆ†æï¼ˆè§‚å¯Ÿè€…ï¼‰
import cartManager from './CartManager';

class Analytics {
  constructor() {
    // è®¢é˜…è´­ç‰©è½¦äº‹ä»¶
    cartManager.on('itemAdded', (item) => {
      this.trackEvent('cart_item_added', {
        item_id: item.id,
        item_name: item.name,
        price: item.price,
      });
    });

    cartManager.on('itemRemoved', (item) => {
      this.trackEvent('cart_item_removed', {
        item_id: item.id,
      });
    });
  }

  trackEvent(eventName, data) {
    console.log('Analytics:', eventName, data);
    // å‘é€åˆ°åˆ†ææœåŠ¡å™¨
  }
}

export default new Analytics();
```

**æ•ˆæœ**ï¼š
- âœ… è§£è€¦ï¼šCartManager ä¸çŸ¥é“è°åœ¨ç›‘å¬
- âœ… æ˜“äºæ‰©å±•ï¼šæ–°å¢åŠŸèƒ½åªéœ€è®¢é˜…äº‹ä»¶
- âœ… å•ä¸€èŒè´£ï¼šæ¯ä¸ªç»„ä»¶åªå…³å¿ƒè‡ªå·±çš„é€»è¾‘
- âœ… åŠ¨æ€è®¢é˜…ï¼šå¯ä»¥éšæ—¶æ·»åŠ /ç§»é™¤è§‚å¯Ÿè€…

---

### ğŸ¯ React ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼

#### ä½¿ç”¨ Context + useReducer å®ç°

```javascript
// CartContext.jsx - ä½¿ç”¨ Context å®ç°è§‚å¯Ÿè€…æ¨¡å¼
import React from 'react';

const CartContext = React.createContext();

function cartReducer(state, action) {
  switch (action.type) {
    case 'ADD_ITEM':
      return {
        ...state,
        items: [...state.items, action.payload],
      };
    case 'REMOVE_ITEM':
      return {
        ...state,
        items: state.items.filter(item => item.id !== action.payload),
      };
    case 'UPDATE_QUANTITY':
      return {
        ...state,
        items: state.items.map(item =>
          item.id === action.payload.id
            ? { ...item, quantity: action.payload.quantity }
            : item
        ),
      };
    case 'CLEAR':
      return {
        ...state,
        items: [],
      };
    default:
      return state;
  }
}

export function CartProvider({ children }) {
  const [state, dispatch] = React.useReducer(cartReducer, { items: [] });

  const addItem = (item) => {
    dispatch({ type: 'ADD_ITEM', payload: item });
  };

  const removeItem = (itemId) => {
    dispatch({ type: 'REMOVE_ITEM', payload: itemId });
  };

  const updateQuantity = (itemId, quantity) => {
    dispatch({ type: 'UPDATE_QUANTITY', payload: { id: itemId, quantity } });
  };

  const clear = () => {
    dispatch({ type: 'CLEAR' });
  };

  const calculateTotal = () => {
    return state.items.reduce((sum, item) => sum + item.price * item.quantity, 0);
  };

  return (
    <CartContext.Provider value={{
      items: state.items,
      addItem,
      removeItem,
      updateQuantity,
      clear,
      calculateTotal,
    }}>
      {children}
    </CartContext.Provider>
  );
}

export const useCart = () => {
  const context = React.useContext(CartContext);
  if (!context) {
    throw new Error('useCart must be used within CartProvider');
  }
  return context;
};
```

```javascript
// ä½¿ç”¨ Context
function App() {
  return (
    <CartProvider>
      <Header />
      <ProductList />
      <CartSidebar />
    </CartProvider>
  );
}

function CartBadge() {
  const { items } = useCart(); // è‡ªåŠ¨è®¢é˜… items å˜åŒ–

  return (
    <div className="cart-badge">
      <span className="icon">ğŸ›’</span>
      {items.length > 0 && <span className="count">{items.length}</span>}
    </div>
  );
}

function ProductCard({ product }) {
  const { addItem } = useCart();

  return (
    <div className="product-card">
      <h4>{product.name}</h4>
      <p>Â¥{product.price}</p>
      <button onClick={() => addItem({ ...product, quantity: 1 })}>
        åŠ å…¥è´­ç‰©è½¦
      </button>
    </div>
  );
}
```

---

### ğŸ—ï¸ çœŸå®ä¸šåŠ¡åœºæ™¯

#### åœºæ™¯1ï¼šå®æ—¶é€šçŸ¥ç³»ç»Ÿ

```javascript
// NotificationManager.js - é€šçŸ¥ç®¡ç†å™¨
import EventEmitter from './EventEmitter';

class NotificationManager extends EventEmitter {
  constructor() {
    super();
    this.notifications = [];
  }

  // æ˜¾ç¤ºé€šçŸ¥
  show(notification) {
    const id = Date.now();
    const notif = {
      id,
      ...notification,
      timestamp: new Date(),
    };

    this.notifications.push(notif);
    this.emit('notificationAdded', notif);

    // è‡ªåŠ¨å…³é—­
    if (notification.duration) {
      setTimeout(() => {
        this.dismiss(id);
      }, notification.duration);
    }

    return id;
  }

  // å…³é—­é€šçŸ¥
  dismiss(id) {
    const notification = this.notifications.find(n => n.id === id);
    if (notification) {
      this.notifications = this.notifications.filter(n => n.id !== id);
      this.emit('notificationDismissed', notification);
    }
  }

  // æ¸…ç©ºæ‰€æœ‰é€šçŸ¥
  clearAll() {
    this.notifications = [];
    this.emit('notificationsCleared');
  }

  // ä¾¿æ·æ–¹æ³•
  success(message, duration = 3000) {
    return this.show({ type: 'success', message, duration });
  }

  error(message, duration = 5000) {
    return this.show({ type: 'error', message, duration });
  }

  warning(message, duration = 4000) {
    return this.show({ type: 'warning', message, duration });
  }

  info(message, duration = 3000) {
    return this.show({ type: 'info', message, duration });
  }
}

export default new NotificationManager();
```

```javascript
// NotificationContainer.jsx - é€šçŸ¥å®¹å™¨ç»„ä»¶
import React from 'react';
import notificationManager from './NotificationManager';

function NotificationContainer() {
  const [notifications, setNotifications] = React.useState([]);

  React.useEffect(() => {
    const handleAdded = (notification) => {
      setNotifications(prev => [...prev, notification]);
    };

    const handleDismissed = (notification) => {
      setNotifications(prev => prev.filter(n => n.id !== notification.id));
    };

    const handleCleared = () => {
      setNotifications([]);
    };

    notificationManager.on('notificationAdded', handleAdded);
    notificationManager.on('notificationDismissed', handleDismissed);
    notificationManager.on('notificationsCleared', handleCleared);

    return () => {
      notificationManager.off('notificationAdded', handleAdded);
      notificationManager.off('notificationDismissed', handleDismissed);
      notificationManager.off('notificationsCleared', handleCleared);
    };
  }, []);

  return (
    <div className="notification-container">
      {notifications.map(notification => (
        <Notification
          key={notification.id}
          notification={notification}
          onClose={() => notificationManager.dismiss(notification.id)}
        />
      ))}
    </div>
  );
}

function Notification({ notification, onClose }) {
  const typeStyles = {
    success: { background: '#52c41a', color: '#fff' },
    error: { background: '#ff4d4f', color: '#fff' },
    warning: { background: '#faad14', color: '#fff' },
    info: { background: '#1890ff', color: '#fff' },
  };

  return (
    <div className="notification" style={typeStyles[notification.type]}>
      <span>{notification.message}</span>
      <button onClick={onClose}>Ã—</button>
    </div>
  );
}

export default NotificationContainer;
```

```javascript
// åœ¨åº”ç”¨ä¸­ä½¿ç”¨
import notificationManager from './NotificationManager';

function LoginForm() {
  const handleLogin = async (credentials) => {
    try {
      await loginAPI(credentials);
      notificationManager.success('ç™»å½•æˆåŠŸï¼');
    } catch (error) {
      notificationManager.error('ç™»å½•å¤±è´¥ï¼š' + error.message);
    }
  };

  // ...
}
```

#### åœºæ™¯2ï¼šWebSocket å®æ—¶æ•°æ®

```javascript
// WebSocketManager.js - WebSocket ç®¡ç†å™¨
import EventEmitter from './EventEmitter';

class WebSocketManager extends EventEmitter {
  constructor() {
    super();
    this.ws = null;
    this.reconnectAttempts = 0;
    this.maxReconnectAttempts = 5;
  }

  connect(url) {
    this.ws = new WebSocket(url);

    this.ws.onopen = () => {
      console.log('WebSocket connected');
      this.reconnectAttempts = 0;
      this.emit('connected');
    };

    this.ws.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);

        // æ ¹æ®æ¶ˆæ¯ç±»å‹è§¦å‘ä¸åŒäº‹ä»¶
        switch (data.type) {
          case 'user_online':
            this.emit('userOnline', data.payload);
            break;
          case 'user_offline':
            this.emit('userOffline', data.payload);
            break;
          case 'new_message':
            this.emit('newMessage', data.payload);
            break;
          case 'order_status_changed':
            this.emit('orderStatusChanged', data.payload);
            break;
          default:
            this.emit('message', data);
        }
      } catch (error) {
        console.error('Failed to parse WebSocket message:', error);
      }
    };

    this.ws.onerror = (error) => {
      console.error('WebSocket error:', error);
      this.emit('error', error);
    };

    this.ws.onclose = () => {
      console.log('WebSocket disconnected');
      this.emit('disconnected');
      this.reconnect(url);
    };
  }

  reconnect(url) {
    if (this.reconnectAttempts < this.maxReconnectAttempts) {
      this.reconnectAttempts++;
      console.log(`Reconnecting... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`);

      setTimeout(() => {
        this.connect(url);
      }, 1000 * this.reconnectAttempts);
    } else {
      this.emit('reconnectFailed');
    }
  }

  send(data) {
    if (this.ws && this.ws.readyState === WebSocket.OPEN) {
      this.ws.send(JSON.stringify(data));
    } else {
      console.error('WebSocket is not connected');
    }
  }

  disconnect() {
    if (this.ws) {
      this.ws.close();
      this.ws = null;
    }
  }
}

export default new WebSocketManager();
```

```javascript
// OnlineUsers.jsx - åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
import React from 'react';
import wsManager from './WebSocketManager';

function OnlineUsers() {
  const [users, setUsers] = React.useState([]);

  React.useEffect(() => {
    const handleUserOnline = (user) => {
      setUsers(prev => [...prev, user]);
    };

    const handleUserOffline = (user) => {
      setUsers(prev => prev.filter(u => u.id !== user.id));
    };

    wsManager.on('userOnline', handleUserOnline);
    wsManager.on('userOffline', handleUserOffline);

    return () => {
      wsManager.off('userOnline', handleUserOnline);
      wsManager.off('userOffline', handleUserOffline);
    };
  }, []);

  return (
    <div className="online-users">
      <h3>åœ¨çº¿ç”¨æˆ· ({users.length})</h3>
      <ul>
        {users.map(user => (
          <li key={user.id}>
            <span className="online-indicator">ğŸŸ¢</span>
            {user.name}
          </li>
        ))}
      </ul>
    </div>
  );
}
```

```javascript
// ChatMessages.jsx - èŠå¤©æ¶ˆæ¯
import React from 'react';
import wsManager from './WebSocketManager';

function ChatMessages() {
  const [messages, setMessages] = React.useState([]);

  React.useEffect(() => {
    const handleNewMessage = (message) => {
      setMessages(prev => [...prev, message]);
    };

    wsManager.on('newMessage', handleNewMessage);

    return () => {
      wsManager.off('newMessage', handleNewMessage);
    };
  }, []);

  return (
    <div className="chat-messages">
      {messages.map((msg, index) => (
        <div key={index} className="message">
          <strong>{msg.username}:</strong> {msg.text}
        </div>
      ))}
    </div>
  );
}
```

---

### ğŸ¨ åœ¨ä¸»æµæ¡†æ¶ä¸­çš„åº”ç”¨

#### Node.js EventEmitter

```javascript
const EventEmitter = require('events');

class MyEmitter extends EventEmitter {}

const myEmitter = new MyEmitter();

myEmitter.on('event', (a, b) => {
  console.log(a, b);
});

myEmitter.emit('event', 'a', 'b');
```

#### Vue å“åº”å¼ç³»ç»Ÿ

```javascript
// Vue 2/3 ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼å®ç°å“åº”å¼
export default {
  data() {
    return {
      count: 0
    };
  },
  watch: {
    // è§‚å¯Ÿ count å˜åŒ–
    count(newValue, oldValue) {
      console.log('count changed:', newValue);
    }
  }
}
```

#### RxJS - å¼ºå¤§çš„è§‚å¯Ÿè€…æ¨¡å¼åº“

```javascript
import { fromEvent } from 'rxjs';
import { debounceTime, map } from 'rxjs/operators';

// ç›‘å¬è¾“å…¥æ¡†å˜åŒ–
const input = document.querySelector('#search');
const search$ = fromEvent(input, 'input').pipe(
  debounceTime(300),
  map(event => event.target.value)
);

search$.subscribe(value => {
  console.log('æœç´¢:', value);
});
```

---

### âš–ï¸ ä¼˜ç¼ºç‚¹åˆ†æ

#### âœ… ä¼˜ç‚¹

1. **è§£è€¦**ï¼šå‘å¸ƒè€…å’Œè®¢é˜…è€…è§£è€¦
2. **åŠ¨æ€å…³ç³»**ï¼šå¯ä»¥åœ¨è¿è¡Œæ—¶å»ºç«‹/è§£é™¤è®¢é˜…
3. **å¹¿æ’­é€šä¿¡**ï¼šä¸€å¯¹å¤šé€šçŸ¥
4. **ç¬¦åˆå¼€é—­åŸåˆ™**ï¼šæ·»åŠ æ–°è§‚å¯Ÿè€…ä¸éœ€è¦ä¿®æ”¹å‘å¸ƒè€…

#### âŒ ç¼ºç‚¹

1. **æ€§èƒ½é—®é¢˜**ï¼šå¤§é‡è§‚å¯Ÿè€…ä¼šå½±å“æ€§èƒ½
2. **å†…å­˜æ³„æ¼**ï¼šå¿˜è®°å–æ¶ˆè®¢é˜…ä¼šå¯¼è‡´å†…å­˜æ³„æ¼
3. **è°ƒè¯•å›°éš¾**ï¼šäº‹ä»¶æµè¿½è¸ªå›°éš¾
4. **é¡ºåºé—®é¢˜**ï¼šè§‚å¯Ÿè€…æ‰§è¡Œé¡ºåºä¸ç¡®å®š

---

### ğŸ“‹ ä½•æ—¶ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼

#### âœ… é€‚åˆä½¿ç”¨çš„åœºæ™¯

- çŠ¶æ€å˜åŒ–éœ€è¦é€šçŸ¥å¤šä¸ªå¯¹è±¡
- äº‹ä»¶ç³»ç»Ÿã€æ¶ˆæ¯æ€»çº¿
- å®æ—¶æ•°æ®åŒæ­¥ï¼ˆWebSocketï¼‰
- è·¨ç»„ä»¶é€šä¿¡
- æ—¥å¿—ã€åˆ†æã€ç›‘æ§ç³»ç»Ÿ

#### âŒ ä¸é€‚åˆä½¿ç”¨çš„åœºæ™¯

- åªæœ‰ä¸€ä¸ªè®¢é˜…è€…
- åŒæ­¥é¡ºåºå¾ˆé‡è¦
- æ€§èƒ½æ•æ„Ÿçš„åœºæ™¯
- ç®€å•çš„çˆ¶å­ç»„ä»¶é€šä¿¡ï¼ˆç”¨ props å³å¯ï¼‰

---

## ç­–ç•¥æ¨¡å¼

### ğŸ’¡ æ¨¡å¼å®šä¹‰
ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼ŒæŠŠå®ƒä»¬å°è£…èµ·æ¥ï¼Œå¹¶ä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚ç­–ç•¥æ¨¡å¼è®©ç®—æ³•ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·ç«¯è€Œå˜åŒ–ã€‚

### ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦ç­–ç•¥æ¨¡å¼ï¼Ÿ

#### é—®é¢˜åœºæ™¯ï¼šè¡¨å•éªŒè¯ã€æ”¯ä»˜æ–¹å¼ã€æ’åºç®—æ³•ç­‰éœ€è¦åˆ‡æ¢çš„é€»è¾‘

#### âŒ ä¸ä½¿ç”¨ç­–ç•¥æ¨¡å¼çš„ç—›ç‚¹

```javascript
// FormValidator.jsx - å……æ»¡ if-else çš„éªŒè¯é€»è¾‘
function validateForm(formData, rules) {
  const errors = {};

  Object.keys(rules).forEach(field => {
    const value = formData[field];
    const rule = rules[field];

    // å¤§é‡ if-else åˆ¤æ–­
    if (rule.required) {
      if (!value || value.trim() === '') {
        errors[field] = `${field} is required`;
        return;
      }
    }

    if (rule.minLength) {
      if (value.length < rule.minLength) {
        errors[field] = `${field} must be at least ${rule.minLength} characters`;
        return;
      }
    }

    if (rule.maxLength) {
      if (value.length > rule.maxLength) {
        errors[field] = `${field} must be at most ${rule.maxLength} characters`;
        return;
      }
    }

    if (rule.email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(value)) {
        errors[field] = `${field} must be a valid email`;
        return;
      }
    }

    if (rule.phone) {
      const phoneRegex = /^1[3-9]\d{9}$/;
      if (!phoneRegex.test(value)) {
        errors[field] = `${field} must be a valid phone number`;
        return;
      }
    }

    if (rule.url) {
      try {
        new URL(value);
      } catch {
        errors[field] = `${field} must be a valid URL`;
        return;
      }
    }

    if (rule.number) {
      if (isNaN(value)) {
        errors[field] = `${field} must be a number`;
        return;
      }
    }

    if (rule.min) {
      if (Number(value) < rule.min) {
        errors[field] = `${field} must be at least ${rule.min}`;
        return;
      }
    }

    if (rule.max) {
      if (Number(value) > rule.max) {
        errors[field] = `${field} must be at most ${rule.max}`;
        return;
      }
    }

    // æ¯æ¬¡æ·»åŠ æ–°è§„åˆ™éƒ½è¦åŠ  if-else...
  });

  return errors;
}
```

**é—®é¢˜**ï¼š
- éš¾ä»¥æ‰©å±•ï¼šæ·»åŠ æ–°è§„åˆ™éœ€è¦ä¿®æ”¹æ ¸å¿ƒä»£ç 
- ä»£ç è‡ƒè‚¿ï¼šå¤§é‡ if-else
- éš¾ä»¥æµ‹è¯•ï¼šæ¯ä¸ªè§„åˆ™éƒ½è€¦åˆåœ¨ä¸€èµ·
- éš¾ä»¥å¤ç”¨ï¼šè§„åˆ™æ— æ³•ç‹¬ç«‹ä½¿ç”¨

---

#### âœ… ä½¿ç”¨ç­–ç•¥æ¨¡å¼è§£å†³

```javascript
// validators/strategies.js - éªŒè¯ç­–ç•¥
const validationStrategies = {
  // å¿…å¡«ç­–ç•¥
  required: (value, errorMsg = 'æ­¤å­—æ®µä¸ºå¿…å¡«') => {
    if (!value || String(value).trim() === '') {
      return errorMsg;
    }
    return null;
  },

  // æœ€å°é•¿åº¦ç­–ç•¥
  minLength: (length, errorMsg) => (value) => {
    if (value && value.length < length) {
      return errorMsg || `æœ€å°‘éœ€è¦ ${length} ä¸ªå­—ç¬¦`;
    }
    return null;
  },

  // æœ€å¤§é•¿åº¦ç­–ç•¥
  maxLength: (length, errorMsg) => (value) => {
    if (value && value.length > length) {
      return errorMsg || `æœ€å¤šå…è®¸ ${length} ä¸ªå­—ç¬¦`;
    }
    return null;
  },

  // é‚®ç®±ç­–ç•¥
  email: (errorMsg = 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€') => (value) => {
    if (!value) return null;
    const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return regex.test(value) ? null : errorMsg;
  },

  // æ‰‹æœºå·ç­–ç•¥
  phone: (errorMsg = 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·') => (value) => {
    if (!value) return null;
    const regex = /^1[3-9]\d{9}$/;
    return regex.test(value) ? null : errorMsg;
  },

  // ç½‘å€ç­–ç•¥
  url: (errorMsg = 'è¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘å€') => (value) => {
    if (!value) return null;
    try {
      new URL(value);
      return null;
    } catch {
      return errorMsg;
    }
  },

  // æ•°å­—ç­–ç•¥
  number: (errorMsg = 'è¯·è¾“å…¥æ•°å­—') => (value) => {
    if (!value) return null;
    return isNaN(value) ? errorMsg : null;
  },

  // æœ€å°å€¼ç­–ç•¥
  min: (minValue, errorMsg) => (value) => {
    if (!value) return null;
    const num = Number(value);
    return num < minValue ? (errorMsg || `æœ€å°å€¼ä¸º ${minValue}`) : null;
  },

  // æœ€å¤§å€¼ç­–ç•¥
  max: (maxValue, errorMsg) => (value) => {
    if (!value) return null;
    const num = Number(value);
    return num > maxValue ? (errorMsg || `æœ€å¤§å€¼ä¸º ${maxValue}`) : null;
  },

  // æ­£åˆ™è¡¨è¾¾å¼ç­–ç•¥
  pattern: (regex, errorMsg = 'æ ¼å¼ä¸æ­£ç¡®') => (value) => {
    if (!value) return null;
    return regex.test(value) ? null : errorMsg;
  },

  // è‡ªå®šä¹‰ç­–ç•¥
  custom: (validatorFn, errorMsg) => (value) => {
    const isValid = validatorFn(value);
    return isValid ? null : errorMsg;
  },
};

export default validationStrategies;
```

```javascript
// FormValidator.js - è¡¨å•éªŒè¯å™¨
import validationStrategies from './validators/strategies';

class FormValidator {
  constructor(rules) {
    this.rules = rules;
    this.compiledRules = this.compileRules(rules);
  }

  // ç¼–è¯‘éªŒè¯è§„åˆ™
  compileRules(rules) {
    const compiled = {};

    Object.keys(rules).forEach(field => {
      const fieldRules = rules[field];
      compiled[field] = [];

      fieldRules.forEach(rule => {
        if (typeof rule === 'function') {
          // ç›´æ¥ä½¿ç”¨å‡½æ•°
          compiled[field].push(rule);
        } else if (typeof rule === 'object') {
          // ä½¿ç”¨ç­–ç•¥é…ç½®
          const { type, ...options } = rule;
          const strategy = validationStrategies[type];

          if (!strategy) {
            console.warn(`Unknown validation strategy: ${type}`);
            return;
          }

          // æ ¹æ®ç­–ç•¥ç±»å‹åˆ›å»ºéªŒè¯å™¨
          if (type === 'required') {
            compiled[field].push((value) => strategy(value, options.message));
          } else {
            compiled[field].push(strategy(options.value, options.message));
          }
        }
      });
    });

    return compiled;
  }

  // éªŒè¯å•ä¸ªå­—æ®µ
  validateField(field, value) {
    const fieldRules = this.compiledRules[field];
    if (!fieldRules) return null;

    for (const rule of fieldRules) {
      const error = rule(value);
      if (error) return error;
    }

    return null;
  }

  // éªŒè¯æ•´ä¸ªè¡¨å•
  validate(formData) {
    const errors = {};

    Object.keys(this.compiledRules).forEach(field => {
      const error = this.validateField(field, formData[field]);
      if (error) {
        errors[field] = error;
      }
    });

    return {
      isValid: Object.keys(errors).length === 0,
      errors,
    };
  }
}

export default FormValidator;
```

```javascript
// LoginForm.jsx - ä½¿ç”¨ç­–ç•¥æ¨¡å¼çš„è¡¨å•
import React from 'react';
import FormValidator from './FormValidator';

function LoginForm() {
  const [formData, setFormData] = React.useState({
    email: '',
    password: '',
  });

  const [errors, setErrors] = React.useState({});

  // å®šä¹‰éªŒè¯è§„åˆ™ï¼ˆä½¿ç”¨ç­–ç•¥ï¼‰
  const validator = React.useMemo(() => {
    return new FormValidator({
      email: [
        { type: 'required', message: 'é‚®ç®±ä¸èƒ½ä¸ºç©º' },
        { type: 'email' },
      ],
      password: [
        { type: 'required', message: 'å¯†ç ä¸èƒ½ä¸ºç©º' },
        { type: 'minLength', value: 6, message: 'å¯†ç è‡³å°‘6ä¸ªå­—ç¬¦' },
        {
          type: 'custom',
          value: (value) => /[A-Z]/.test(value) && /[0-9]/.test(value),
          message: 'å¯†ç å¿…é¡»åŒ…å«å¤§å†™å­—æ¯å’Œæ•°å­—',
        },
      ],
    });
  }, []);

  const handleChange = (field, value) => {
    setFormData(prev => ({ ...prev, [field]: value }));

    // å®æ—¶éªŒè¯
    const error = validator.validateField(field, value);
    setErrors(prev => ({ ...prev, [field]: error }));
  };

  const handleSubmit = (e) => {
    e.preventDefault();

    const { isValid, errors: validationErrors } = validator.validate(formData);

    if (isValid) {
      console.log('æäº¤è¡¨å•:', formData);
    } else {
      setErrors(validationErrors);
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <div>
        <input
          type="email"
          placeholder="é‚®ç®±"
          value={formData.email}
          onChange={(e) => handleChange('email', e.target.value)}
        />
        {errors.email && <span className="error">{errors.email}</span>}
      </div>

      <div>
        <input
          type="password"
          placeholder="å¯†ç "
          value={formData.password}
          onChange={(e) => handleChange('password', e.target.value)}
        />
        {errors.password && <span className="error">{errors.password}</span>}
      </div>

      <button type="submit">ç™»å½•</button>
    </form>
  );
}

export default LoginForm;
```

**æ•ˆæœ**ï¼š
- âœ… æ˜“äºæ‰©å±•ï¼šæ·»åŠ æ–°ç­–ç•¥ä¸ä¿®æ”¹æ ¸å¿ƒä»£ç 
- âœ… ä»£ç æ¸…æ™°ï¼šæ¯ä¸ªç­–ç•¥ç‹¬ç«‹
- âœ… æ˜“äºæµ‹è¯•ï¼šå¯ä»¥ç‹¬ç«‹æµ‹è¯•æ¯ä¸ªç­–ç•¥
- âœ… é«˜åº¦å¤ç”¨ï¼šç­–ç•¥å¯ä»¥åœ¨å¤šä¸ªè¡¨å•ä¸­å¤ç”¨

---

### ğŸ—ï¸ çœŸå®ä¸šåŠ¡åœºæ™¯

#### åœºæ™¯1ï¼šæ”¯ä»˜æ–¹å¼ç­–ç•¥

```javascript
// payment/strategies.js - æ”¯ä»˜ç­–ç•¥
class PaymentStrategy {
  pay(amount) {
    throw new Error('Subclass must implement pay method');
  }

  refund(transactionId, amount) {
    throw new Error('Subclass must implement refund method');
  }
}

// æ”¯ä»˜å®ç­–ç•¥
class AlipayStrategy extends PaymentStrategy {
  async pay(amount) {
    console.log(`ä½¿ç”¨æ”¯ä»˜å®æ”¯ä»˜ Â¥${amount}`);

    // è°ƒç”¨æ”¯ä»˜å® SDK
    return {
      success: true,
      transactionId: 'ALIPAY-' + Date.now(),
      method: 'alipay',
    };
  }

  async refund(transactionId, amount) {
    console.log(`æ”¯ä»˜å®é€€æ¬¾ Â¥${amount}`);
    return { success: true };
  }
}

// å¾®ä¿¡æ”¯ä»˜ç­–ç•¥
class WechatStrategy extends PaymentStrategy {
  async pay(amount) {
    console.log(`ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜ Â¥${amount}`);

    // è°ƒç”¨å¾®ä¿¡æ”¯ä»˜ SDK
    return {
      success: true,
      transactionId: 'WECHAT-' + Date.now(),
      method: 'wechat',
    };
  }

  async refund(transactionId, amount) {
    console.log(`å¾®ä¿¡é€€æ¬¾ Â¥${amount}`);
    return { success: true };
  }
}

// ä¿¡ç”¨å¡ç­–ç•¥
class CreditCardStrategy extends PaymentStrategy {
  constructor(cardInfo) {
    super();
    this.cardInfo = cardInfo;
  }

  async pay(amount) {
    console.log(`ä½¿ç”¨ä¿¡ç”¨å¡æ”¯ä»˜ Â¥${amount}`);
    console.log('å¡å·:', this.cardInfo.number);

    // è°ƒç”¨æ”¯ä»˜ç½‘å…³
    return {
      success: true,
      transactionId: 'CARD-' + Date.now(),
      method: 'credit_card',
    };
  }

  async refund(transactionId, amount) {
    console.log(`ä¿¡ç”¨å¡é€€æ¬¾ Â¥${amount}`);
    return { success: true };
  }
}

// ä½™é¢æ”¯ä»˜ç­–ç•¥
class BalanceStrategy extends PaymentStrategy {
  constructor(userId) {
    super();
    this.userId = userId;
  }

  async pay(amount) {
    // æ£€æŸ¥ä½™é¢
    const balance = await this.getBalance();

    if (balance < amount) {
      throw new Error('ä½™é¢ä¸è¶³');
    }

    console.log(`ä½¿ç”¨ä½™é¢æ”¯ä»˜ Â¥${amount}`);
    await this.deductBalance(amount);

    return {
      success: true,
      transactionId: 'BALANCE-' + Date.now(),
      method: 'balance',
    };
  }

  async refund(transactionId, amount) {
    console.log(`ä½™é¢é€€æ¬¾ Â¥${amount}`);
    await this.addBalance(amount);
    return { success: true };
  }

  async getBalance() {
    // è·å–ç”¨æˆ·ä½™é¢
    return 1000;
  }

  async deductBalance(amount) {
    // æ‰£é™¤ä½™é¢
  }

  async addBalance(amount) {
    // å¢åŠ ä½™é¢
  }
}

export {
  PaymentStrategy,
  AlipayStrategy,
  WechatStrategy,
  CreditCardStrategy,
  BalanceStrategy,
};
```

```javascript
// PaymentManager.js - æ”¯ä»˜ç®¡ç†å™¨
class PaymentManager {
  constructor() {
    this.strategy = null;
  }

  setStrategy(strategy) {
    this.strategy = strategy;
  }

  async executePayment(amount) {
    if (!this.strategy) {
      throw new Error('Payment strategy not set');
    }

    try {
      const result = await this.strategy.pay(amount);
      console.log('æ”¯ä»˜æˆåŠŸ:', result);
      return result;
    } catch (error) {
      console.error('æ”¯ä»˜å¤±è´¥:', error);
      throw error;
    }
  }

  async executeRefund(transactionId, amount) {
    if (!this.strategy) {
      throw new Error('Payment strategy not set');
    }

    try {
      const result = await this.strategy.refund(transactionId, amount);
      console.log('é€€æ¬¾æˆåŠŸ:', result);
      return result;
    } catch (error) {
      console.error('é€€æ¬¾å¤±è´¥:', error);
      throw error;
    }
  }
}

export default PaymentManager;
```

```javascript
// CheckoutPage.jsx - ç»“è´¦é¡µé¢
import React from 'react';
import PaymentManager from './PaymentManager';
import {
  AlipayStrategy,
  WechatStrategy,
  CreditCardStrategy,
  BalanceStrategy,
} from './payment/strategies';

function CheckoutPage({ totalAmount }) {
  const [paymentMethod, setPaymentMethod] = React.useState('alipay');
  const [paying, setPaying] = React.useState(false);

  const paymentManager = React.useMemo(() => new PaymentManager(), []);

  const handlePay = async () => {
    setPaying(true);

    try {
      // æ ¹æ®é€‰æ‹©çš„æ”¯ä»˜æ–¹å¼è®¾ç½®ç­–ç•¥
      switch (paymentMethod) {
        case 'alipay':
          paymentManager.setStrategy(new AlipayStrategy());
          break;
        case 'wechat':
          paymentManager.setStrategy(new WechatStrategy());
          break;
        case 'credit_card':
          paymentManager.setStrategy(new CreditCardStrategy({
            number: '4111111111111111',
            cvv: '123',
            expiry: '12/25',
          }));
          break;
        case 'balance':
          paymentManager.setStrategy(new BalanceStrategy('user123'));
          break;
        default:
          throw new Error('Invalid payment method');
      }

      // æ‰§è¡Œæ”¯ä»˜ï¼ˆä¸å…³å¿ƒå…·ä½“å®ç°ï¼‰
      const result = await paymentManager.executePayment(totalAmount);
      alert('æ”¯ä»˜æˆåŠŸï¼');
    } catch (error) {
      alert('æ”¯ä»˜å¤±è´¥ï¼š' + error.message);
    } finally {
      setPaying(false);
    }
  };

  return (
    <div className="checkout-page">
      <h2>æ”¯ä»˜ Â¥{totalAmount}</h2>

      <div className="payment-methods">
        <label>
          <input
            type="radio"
            value="alipay"
            checked={paymentMethod === 'alipay'}
            onChange={(e) => setPaymentMethod(e.target.value)}
          />
          æ”¯ä»˜å®
        </label>

        <label>
          <input
            type="radio"
            value="wechat"
            checked={paymentMethod === 'wechat'}
            onChange={(e) => setPaymentMethod(e.target.value)}
          />
          å¾®ä¿¡æ”¯ä»˜
        </label>

        <label>
          <input
            type="radio"
            value="credit_card"
            checked={paymentMethod === 'credit_card'}
            onChange={(e) => setPaymentMethod(e.target.value)}
          />
          ä¿¡ç”¨å¡
        </label>

        <label>
          <input
            type="radio"
            value="balance"
            checked={paymentMethod === 'balance'}
            onChange={(e) => setPaymentMethod(e.target.value)}
          />
          ä½™é¢æ”¯ä»˜
        </label>
      </div>

      <button onClick={handlePay} disabled={paying}>
        {paying ? 'æ”¯ä»˜ä¸­...' : 'ç¡®è®¤æ”¯ä»˜'}
      </button>
    </div>
  );
}

export default CheckoutPage;
```

#### åœºæ™¯2ï¼šæ’åºç­–ç•¥

```javascript
// sorting/strategies.js - æ’åºç­–ç•¥
class SortStrategy {
  sort(items) {
    throw new Error('Subclass must implement sort method');
  }
}

// ä»·æ ¼å‡åº
class PriceAscStrategy extends SortStrategy {
  sort(items) {
    return [...items].sort((a, b) => a.price - b.price);
  }
}

// ä»·æ ¼é™åº
class PriceDescStrategy extends SortStrategy {
  sort(items) {
    return [...items].sort((a, b) => b.price - a.price);
  }
}

// æŒ‰è¯„åˆ†æ’åº
class RatingStrategy extends SortStrategy {
  sort(items) {
    return [...items].sort((a, b) => b.rating - a.rating);
  }
}

// æŒ‰é”€é‡æ’åº
class SalesStrategy extends SortStrategy {
  sort(items) {
    return [...items].sort((a, b) => b.sales - a.sales);
  }
}

// æŒ‰æœ€æ–°æ’åº
class NewestStrategy extends SortStrategy {
  sort(items) {
    return [...items].sort((a, b) =>
      new Date(b.createdAt) - new Date(a.createdAt)
    );
  }
}

export {
  PriceAscStrategy,
  PriceDescStrategy,
  RatingStrategy,
  SalesStrategy,
  NewestStrategy,
};
```

```javascript
// ProductList.jsx - å•†å“åˆ—è¡¨
import React from 'react';
import {
  PriceAscStrategy,
  PriceDescStrategy,
  RatingStrategy,
  SalesStrategy,
  NewestStrategy,
} from './sorting/strategies';

function ProductList({ products }) {
  const [sortBy, setSortBy] = React.useState('price_asc');

  const sortStrategies = {
    price_asc: new PriceAscStrategy(),
    price_desc: new PriceDescStrategy(),
    rating: new RatingStrategy(),
    sales: new SalesStrategy(),
    newest: new NewestStrategy(),
  };

  const sortedProducts = React.useMemo(() => {
    const strategy = sortStrategies[sortBy];
    return strategy.sort(products);
  }, [products, sortBy]);

  return (
    <div className="product-list">
      <div className="sort-options">
        <label>æ’åºæ–¹å¼:</label>
        <select value={sortBy} onChange={(e) => setSortBy(e.target.value)}>
          <option value="price_asc">ä»·æ ¼ä»ä½åˆ°é«˜</option>
          <option value="price_desc">ä»·æ ¼ä»é«˜åˆ°ä½</option>
          <option value="rating">æŒ‰è¯„åˆ†</option>
          <option value="sales">æŒ‰é”€é‡</option>
          <option value="newest">æœ€æ–°ä¸Šæ¶</option>
        </select>
      </div>

      <div className="products">
        {sortedProducts.map(product => (
          <ProductCard key={product.id} product={product} />
        ))}
      </div>
    </div>
  );
}

function ProductCard({ product }) {
  return (
    <div className="product-card">
      <h4>{product.name}</h4>
      <p>ä»·æ ¼: Â¥{product.price}</p>
      <p>è¯„åˆ†: {product.rating}â­</p>
      <p>é”€é‡: {product.sales}</p>
    </div>
  );
}

export default ProductList;
```

---

### ğŸ¨ åœ¨ä¸»æµæ¡†æ¶ä¸­çš„åº”ç”¨

#### React Hooks - ç­–ç•¥æ¨¡å¼çš„åº”ç”¨

```javascript
// useAuth hook ä½¿ç”¨ä¸åŒçš„è®¤è¯ç­–ç•¥
function useAuth(strategy = 'jwt') {
  const strategies = {
    jwt: useJWTAuth,
    oauth: useOAuthAuth,
    session: useSessionAuth,
  };

  return strategies[strategy]();
}

function useJWTAuth() {
  // JWT è®¤è¯é€»è¾‘
}

function useOAuthAuth() {
  // OAuth è®¤è¯é€»è¾‘
}

function useSessionAuth() {
  // Session è®¤è¯é€»è¾‘
}
```

#### Passport.js - è®¤è¯ç­–ç•¥

```javascript
const passport = require('passport');
const LocalStrategy = require('passport-local').Strategy;
const GoogleStrategy = require('passport-google-oauth20').Strategy;

// ä½¿ç”¨æœ¬åœ°ç­–ç•¥
passport.use(new LocalStrategy(
  function(username, password, done) {
    // éªŒè¯é€»è¾‘
  }
));

// ä½¿ç”¨ Google ç­–ç•¥
passport.use(new GoogleStrategy({
    clientID: GOOGLE_CLIENT_ID,
    clientSecret: GOOGLE_CLIENT_SECRET,
    callbackURL: "http://localhost:3000/auth/google/callback"
  },
  function(accessToken, refreshToken, profile, cb) {
    // éªŒè¯é€»è¾‘
  }
));
```

---

### âš–ï¸ ä¼˜ç¼ºç‚¹åˆ†æ

#### âœ… ä¼˜ç‚¹

1. **å¼€é—­åŸåˆ™**ï¼šæ·»åŠ æ–°ç­–ç•¥ä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç 
2. **æ¶ˆé™¤æ¡ä»¶è¯­å¥**ï¼šé¿å…å¤§é‡ if-else
3. **ç®—æ³•ç‹¬ç«‹**ï¼šæ¯ä¸ªç­–ç•¥ç‹¬ç«‹ï¼Œæ˜“äºæµ‹è¯•
4. **è¿è¡Œæ—¶åˆ‡æ¢**ï¼šå¯ä»¥åœ¨è¿è¡Œæ—¶åˆ‡æ¢ç­–ç•¥

#### âŒ ç¼ºç‚¹

1. **ç±»æ•°é‡å¢åŠ **ï¼šæ¯ä¸ªç­–ç•¥éƒ½æ˜¯ä¸€ä¸ªç±»
2. **å®¢æˆ·ç«¯å¿…é¡»äº†è§£ç­–ç•¥**ï¼šéœ€è¦çŸ¥é“æœ‰å“ªäº›ç­–ç•¥å¯é€‰
3. **ç­–ç•¥é—´é€šä¿¡**ï¼šç­–ç•¥ä¹‹é—´å¾ˆéš¾å…±äº«æ•°æ®

---

### ğŸ“‹ ä½•æ—¶ä½¿ç”¨ç­–ç•¥æ¨¡å¼

#### âœ… é€‚åˆä½¿ç”¨çš„åœºæ™¯

- è¡¨å•éªŒè¯è§„åˆ™
- æ”¯ä»˜æ–¹å¼ã€ç‰©æµæ–¹å¼
- æ’åºç®—æ³•ã€æœç´¢ç®—æ³•
- æ•°æ®æ ¼å¼åŒ–ã€æ•°æ®è½¬æ¢
- è®¤è¯æ–¹å¼ã€åŠ å¯†ç®—æ³•

#### âŒ ä¸é€‚åˆä½¿ç”¨çš„åœºæ™¯

- åªæœ‰ä¸€ä¸¤ç§ç®—æ³•
- ç®—æ³•å¾ˆå°‘å˜åŒ–
- ç­–ç•¥ä¹‹é—´éœ€è¦å…±äº«å¤§é‡æ•°æ®

---

## å‘½ä»¤æ¨¡å¼

### ğŸ’¡ æ¨¡å¼å®šä¹‰
å‘½ä»¤æ¨¡å¼ï¼ˆCommand Patternï¼‰å°†è¯·æ±‚å°è£…æˆå¯¹è±¡ï¼Œä»è€Œå¯ä»¥ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–ï¼Œå¯¹è¯·æ±‚æ’é˜Ÿæˆ–è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä»¥åŠæ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚

### ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦å‘½ä»¤æ¨¡å¼ï¼Ÿ

#### é—®é¢˜åœºæ™¯ï¼šæ’¤é”€é‡åšã€æ“ä½œå†å²ã€å®å‘½ä»¤

å‡è®¾ä½ åœ¨å¼€å‘ä¸€ä¸ªå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œéœ€è¦æ”¯æŒæ’¤é”€/é‡åšåŠŸèƒ½ï¼š

#### âŒ ä¸ä½¿ç”¨å‘½ä»¤æ¨¡å¼çš„ç—›ç‚¹

```javascript
// TextEditor.jsx - éš¾ä»¥å®ç°æ’¤é”€é‡åš
function TextEditor() {
  const [content, setContent] = React.useState('');
  const [history, setHistory] = React.useState([]);
  const [historyIndex, setHistoryIndex] = React.useState(-1);

  const handleInsertText = (text, position) => {
    const newContent =
      content.slice(0, position) + text + content.slice(position);
    setContent(newContent);

    // å¦‚ä½•ä¿å­˜è¶³å¤Ÿçš„ä¿¡æ¯æ¥æ’¤é”€ï¼Ÿ
    // éœ€è¦è®°å½•ï¼šæ“ä½œç±»å‹ã€ä½ç½®ã€æ–‡æœ¬ã€æ—§å†…å®¹...
    setHistory([...history.slice(0, historyIndex + 1), {
      type: 'insert',
      text,
      position,
      oldContent: content,
    }]);
    setHistoryIndex(historyIndex + 1);
  };

  const handleDeleteText = (start, end) => {
    const deletedText = content.slice(start, end);
    const newContent = content.slice(0, start) + content.slice(end);
    setContent(newContent);

    setHistory([...history.slice(0, historyIndex + 1), {
      type: 'delete',
      start,
      end,
      deletedText,
      oldContent: content,
    }]);
    setHistoryIndex(historyIndex + 1);
  };

  const handleBold = (start, end) => {
    // åŠ ç²—æ“ä½œ...
    // åˆè¦è®°å½•ä¸åŒçš„å†å²ä¿¡æ¯
  };

  const handleUndo = () => {
    if (historyIndex < 0) return;

    const action = history[historyIndex];

    // æ ¹æ®ä¸åŒæ“ä½œç±»å‹ï¼Œæ‰§è¡Œä¸åŒçš„æ’¤é”€é€»è¾‘
    if (action.type === 'insert') {
      setContent(action.oldContent);
    } else if (action.type === 'delete') {
      const newContent =
        content.slice(0, action.start) +
        action.deletedText +
        content.slice(action.start);
      setContent(newContent);
    } else if (action.type === 'bold') {
      // æ’¤é”€åŠ ç²—...
    }
    // æ¯ç§æ“ä½œéƒ½è¦å†™æ’¤é”€é€»è¾‘ï¼

    setHistoryIndex(historyIndex - 1);
  };

  const handleRedo = () => {
    // é‡åšä¹Ÿè¦å†™ä¸€éé€»è¾‘...
  };

  // ...
}
```

**é—®é¢˜**ï¼š
- æ’¤é”€é€»è¾‘å¤æ‚ï¼šæ¯ç§æ“ä½œéƒ½è¦å†™æ’¤é”€/é‡åšé€»è¾‘
- éš¾ä»¥æ‰©å±•ï¼šæ–°å¢æ“ä½œéœ€è¦ä¿®æ”¹æ’¤é”€/é‡åšä»£ç 
- ä»£ç é‡å¤ï¼šç›¸ä¼¼çš„å†å²è®°å½•é€»è¾‘
- éš¾ä»¥æµ‹è¯•ï¼šæ“ä½œå’Œæ’¤é”€è€¦åˆåœ¨ä¸€èµ·

---

#### âœ… ä½¿ç”¨å‘½ä»¤æ¨¡å¼è§£å†³

```javascript
// commands/Command.js - å‘½ä»¤åŸºç±»
class Command {
  execute() {
    throw new Error('Subclass must implement execute method');
  }

  undo() {
    throw new Error('Subclass must implement undo method');
  }

  redo() {
    return this.execute();
  }
}

export default Command;
```

```javascript
// commands/InsertTextCommand.js - æ’å…¥æ–‡æœ¬å‘½ä»¤
import Command from './Command';

class InsertTextCommand extends Command {
  constructor(editor, text, position) {
    super();
    this.editor = editor;
    this.text = text;
    this.position = position;
    this.oldContent = null;
  }

  execute() {
    // ä¿å­˜æ—§å†…å®¹
    this.oldContent = this.editor.getContent();

    // æ‰§è¡Œæ’å…¥
    const content = this.editor.getContent();
    const newContent =
      content.slice(0, this.position) +
      this.text +
      content.slice(this.position);

    this.editor.setContent(newContent);
    return true;
  }

  undo() {
    // æ¢å¤æ—§å†…å®¹
    this.editor.setContent(this.oldContent);
  }
}

export default InsertTextCommand;
```

```javascript
// commands/DeleteTextCommand.js - åˆ é™¤æ–‡æœ¬å‘½ä»¤
import Command from './Command';

class DeleteTextCommand extends Command {
  constructor(editor, start, end) {
    super();
    this.editor = editor;
    this.start = start;
    this.end = end;
    this.deletedText = null;
  }

  execute() {
    const content = this.editor.getContent();

    // ä¿å­˜è¢«åˆ é™¤çš„æ–‡æœ¬
    this.deletedText = content.slice(this.start, this.end);

    // æ‰§è¡Œåˆ é™¤
    const newContent = content.slice(0, this.start) + content.slice(this.end);
    this.editor.setContent(newContent);
    return true;
  }

  undo() {
    // æ¢å¤è¢«åˆ é™¤çš„æ–‡æœ¬
    const content = this.editor.getContent();
    const newContent =
      content.slice(0, this.start) +
      this.deletedText +
      content.slice(this.start);

    this.editor.setContent(newContent);
  }
}

export default DeleteTextCommand;
```

```javascript
// commands/BoldTextCommand.js - åŠ ç²—æ–‡æœ¬å‘½ä»¤
import Command from './Command';

class BoldTextCommand extends Command {
  constructor(editor, start, end) {
    super();
    this.editor = editor;
    this.start = start;
    this.end = end;
    this.oldFormat = null;
  }

  execute() {
    // ä¿å­˜æ—§æ ¼å¼
    this.oldFormat = this.editor.getFormat(this.start, this.end);

    // åº”ç”¨åŠ ç²—
    this.editor.applyFormat(this.start, this.end, { bold: true });
    return true;
  }

  undo() {
    // æ¢å¤æ—§æ ¼å¼
    this.editor.applyFormat(this.start, this.end, this.oldFormat);
  }
}

export default BoldTextCommand;
```

```javascript
// CommandManager.js - å‘½ä»¤ç®¡ç†å™¨
class CommandManager {
  constructor() {
    this.history = [];
    this.currentIndex = -1;
  }

  // æ‰§è¡Œå‘½ä»¤
  execute(command) {
    // æ¸…é™¤å½“å‰ä½ç½®ä¹‹åçš„å†å²
    this.history = this.history.slice(0, this.currentIndex + 1);

    // æ‰§è¡Œå‘½ä»¤
    const success = command.execute();

    if (success) {
      // æ·»åŠ åˆ°å†å²
      this.history.push(command);
      this.currentIndex++;
    }

    return success;
  }

  // æ’¤é”€
  undo() {
    if (!this.canUndo()) return false;

    const command = this.history[this.currentIndex];
    command.undo();
    this.currentIndex--;

    return true;
  }

  // é‡åš
  redo() {
    if (!this.canRedo()) return false;

    this.currentIndex++;
    const command = this.history[this.currentIndex];
    command.redo();

    return true;
  }

  canUndo() {
    return this.currentIndex >= 0;
  }

  canRedo() {
    return this.currentIndex < this.history.length - 1;
  }

  getHistory() {
    return this.history.map((cmd, index) => ({
      name: cmd.constructor.name,
      active: index <= this.currentIndex,
    }));
  }

  clear() {
    this.history = [];
    this.currentIndex = -1;
  }
}

export default CommandManager;
```

```javascript
// TextEditor.jsx - ä½¿ç”¨å‘½ä»¤æ¨¡å¼çš„ç¼–è¾‘å™¨
import React from 'react';
import CommandManager from './CommandManager';
import InsertTextCommand from './commands/InsertTextCommand';
import DeleteTextCommand from './commands/DeleteTextCommand';
import BoldTextCommand from './commands/BoldTextCommand';

function TextEditor() {
  const [content, setContent] = React.useState('');
  const [selection, setSelection] = React.useState({ start: 0, end: 0 });
  const [formats, setFormats] = React.useState({});

  const commandManager = React.useRef(new CommandManager());

  // ç¼–è¾‘å™¨æ¥å£
  const editor = React.useMemo(() => ({
    getContent: () => content,
    setContent,
    getFormat: (start, end) => formats[`${start}-${end}`] || {},
    applyFormat: (start, end, format) => {
      setFormats(prev => ({
        ...prev,
        [`${start}-${end}`]: format,
      }));
    },
  }), [content, formats]);

  const handleInsert = (text) => {
    const command = new InsertTextCommand(editor, text, selection.start);
    commandManager.current.execute(command);
  };

  const handleDelete = () => {
    if (selection.start === selection.end) return;
    const command = new DeleteTextCommand(editor, selection.start, selection.end);
    commandManager.current.execute(command);
  };

  const handleBold = () => {
    if (selection.start === selection.end) return;
    const command = new BoldTextCommand(editor, selection.start, selection.end);
    commandManager.current.execute(command);
  };

  const handleUndo = () => {
    commandManager.current.undo();
  };

  const handleRedo = () => {
    commandManager.current.redo();
  };

  return (
    <div className="text-editor">
      <div className="toolbar">
        <button onClick={() => handleInsert('Hello')}>æ’å…¥ Hello</button>
        <button onClick={handleDelete}>åˆ é™¤é€‰ä¸­</button>
        <button onClick={handleBold}>åŠ ç²—</button>
        <button
          onClick={handleUndo}
          disabled={!commandManager.current.canUndo()}
        >
          æ’¤é”€
        </button>
        <button
          onClick={handleRedo}
          disabled={!commandManager.current.canRedo()}
        >
          é‡åš
        </button>
      </div>

      <textarea
        value={content}
        onChange={(e) => {
          const command = new InsertTextCommand(
            editor,
            e.target.value.slice(content.length),
            content.length
          );
          commandManager.current.execute(command);
        }}
        onSelect={(e) => {
          setSelection({
            start: e.target.selectionStart,
            end: e.target.selectionEnd,
          });
        }}
      />

      <HistoryPanel commandManager={commandManager.current} />
    </div>
  );
}

function HistoryPanel({ commandManager }) {
  const [history, setHistory] = React.useState([]);

  React.useEffect(() => {
    const interval = setInterval(() => {
      setHistory(commandManager.getHistory());
    }, 100);

    return () => clearInterval(interval);
  }, [commandManager]);

  return (
    <div className="history-panel">
      <h4>æ“ä½œå†å²</h4>
      <ul>
        {history.map((item, index) => (
          <li key={index} className={item.active ? 'active' : 'inactive'}>
            {item.name}
          </li>
        ))}
      </ul>
    </div>
  );
}

export default TextEditor;
```

**æ•ˆæœ**ï¼š
- âœ… ç»Ÿä¸€æ¥å£ï¼šæ‰€æœ‰å‘½ä»¤éƒ½æœ‰ execute/undo/redo æ–¹æ³•
- âœ… æ˜“äºæ‰©å±•ï¼šæ–°å¢å‘½ä»¤ä¸å½±å“ç°æœ‰ä»£ç 
- âœ… æ“ä½œå†å²ï¼šè‡ªåŠ¨è®°å½•æ‰€æœ‰æ“ä½œ
- âœ… æ˜“äºæµ‹è¯•ï¼šå¯ä»¥ç‹¬ç«‹æµ‹è¯•æ¯ä¸ªå‘½ä»¤

---

### ğŸ—ï¸ çœŸå®ä¸šåŠ¡åœºæ™¯

#### åœºæ™¯1ï¼šå›¾å½¢ç¼–è¾‘å™¨ï¼ˆç§»åŠ¨ã€ç¼©æ”¾ã€æ—‹è½¬ï¼‰

```javascript
// commands/MoveCommand.js
class MoveCommand extends Command {
  constructor(shape, deltaX, deltaY) {
    super();
    this.shape = shape;
    this.deltaX = deltaX;
    this.deltaY = deltaY;
  }

  execute() {
    this.shape.x += this.deltaX;
    this.shape.y += this.deltaY;
  }

  undo() {
    this.shape.x -= this.deltaX;
    this.shape.y -= this.deltaY;
  }
}

// commands/ResizeCommand.js
class ResizeCommand extends Command {
  constructor(shape, newWidth, newHeight) {
    super();
    this.shape = shape;
    this.newWidth = newWidth;
    this.newHeight = newHeight;
    this.oldWidth = shape.width;
    this.oldHeight = shape.height;
  }

  execute() {
    this.shape.width = this.newWidth;
    this.shape.height = this.newHeight;
  }

  undo() {
    this.shape.width = this.oldWidth;
    this.shape.height = this.oldHeight;
  }
}

// commands/MacroCommand.js - å®å‘½ä»¤ï¼ˆç»„åˆå¤šä¸ªå‘½ä»¤ï¼‰
class MacroCommand extends Command {
  constructor(commands = []) {
    super();
    this.commands = commands;
  }

  add(command) {
    this.commands.push(command);
  }

  execute() {
    this.commands.forEach(command => command.execute());
  }

  undo() {
    // é€†åºæ’¤é”€
    for (let i = this.commands.length - 1; i >= 0; i--) {
      this.commands[i].undo();
    }
  }
}
```

#### åœºæ™¯2ï¼šä»»åŠ¡é˜Ÿåˆ—

```javascript
// TaskQueue.js - ä»»åŠ¡é˜Ÿåˆ—
class TaskQueue {
  constructor() {
    this.queue = [];
    this.history = [];
    this.isProcessing = false;
  }

  // æ·»åŠ ä»»åŠ¡
  enqueue(command) {
    this.queue.push(command);
    this.processNext();
  }

  // å¤„ç†ä¸‹ä¸€ä¸ªä»»åŠ¡
  async processNext() {
    if (this.isProcessing || this.queue.length === 0) return;

    this.isProcessing = true;
    const command = this.queue.shift();

    try {
      await command.execute();
      this.history.push(command);
      console.log(`ä»»åŠ¡å®Œæˆ: ${command.constructor.name}`);
    } catch (error) {
      console.error(`ä»»åŠ¡å¤±è´¥: ${command.constructor.name}`, error);
      // å¯ä»¥é€‰æ‹©é‡è¯•æˆ–è·³è¿‡
    } finally {
      this.isProcessing = false;
      this.processNext();
    }
  }

  // å–æ¶ˆæ‰€æœ‰ä»»åŠ¡
  cancelAll() {
    this.queue = [];
  }

  // é‡è¯•å¤±è´¥çš„ä»»åŠ¡
  retryLast() {
    if (this.history.length === 0) return;
    const lastCommand = this.history[this.history.length - 1];
    this.enqueue(lastCommand);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const taskQueue = new TaskQueue();

class UploadFileCommand extends Command {
  constructor(file) {
    super();
    this.file = file;
  }

  async execute() {
    console.log(`ä¸Šä¼ æ–‡ä»¶: ${this.file.name}`);
    // æ¨¡æ‹Ÿä¸Šä¼ 
    await new Promise(resolve => setTimeout(resolve, 1000));
  }
}

// æ‰¹é‡ä¸Šä¼ 
files.forEach(file => {
  taskQueue.enqueue(new UploadFileCommand(file));
});
```

---

### ğŸ¨ åœ¨ä¸»æµæ¡†æ¶ä¸­çš„åº”ç”¨

#### Redux Action - å‘½ä»¤æ¨¡å¼

```javascript
// Redux çš„ Action å°±æ˜¯å‘½ä»¤æ¨¡å¼
const incrementAction = { type: 'INCREMENT' };
const decrementAction = { type: 'DECREMENT' };

// Dispatch å°±æ˜¯æ‰§è¡Œå‘½ä»¤
dispatch(incrementAction);

// Redux DevTools æ”¯æŒæ—¶é—´æ—…è¡Œï¼ˆæ’¤é”€/é‡åšï¼‰
```

#### Git å‘½ä»¤ - å‘½ä»¤æ¨¡å¼çš„å…¸èŒƒ

```bash
git add .           # æ·»åŠ åˆ°æš‚å­˜åŒºï¼ˆå¯æ’¤é”€ï¼‰
git commit -m "..."  # æäº¤ï¼ˆå¯æ’¤é”€ï¼‰
git revert HEAD     # æ’¤é”€æœ€åä¸€æ¬¡æäº¤
git reset --hard    # é‡ç½®åˆ°æŸä¸ªçŠ¶æ€
```

---

### âš–ï¸ ä¼˜ç¼ºç‚¹åˆ†æ

#### âœ… ä¼˜ç‚¹

1. **è§£è€¦**ï¼šè°ƒç”¨è€…å’Œæ¥æ”¶è€…è§£è€¦
2. **å¯æ’¤é”€**ï¼šè½»æ¾å®ç°æ’¤é”€/é‡åš
3. **å¯ç»„åˆ**ï¼šå¯ä»¥ç»„åˆå¤šä¸ªå‘½ä»¤ï¼ˆå®å‘½ä»¤ï¼‰
4. **å¯è®°å½•**ï¼šå¯ä»¥è®°å½•æ“ä½œå†å²
5. **å¯æ’é˜Ÿ**ï¼šå¯ä»¥å®ç°ä»»åŠ¡é˜Ÿåˆ—

#### âŒ ç¼ºç‚¹

1. **ç±»æ•°é‡å¢åŠ **ï¼šæ¯ä¸ªæ“ä½œéƒ½æ˜¯ä¸€ä¸ªå‘½ä»¤ç±»
2. **å†…å­˜å¼€é”€**ï¼šéœ€è¦ä¿å­˜å†å²çŠ¶æ€
3. **å¤æ‚åº¦**ï¼šç®€å•æ“ä½œä¹Ÿè¦å°è£…æˆå‘½ä»¤

---

### ğŸ“‹ ä½•æ—¶ä½¿ç”¨å‘½ä»¤æ¨¡å¼

#### âœ… é€‚åˆä½¿ç”¨çš„åœºæ™¯

- æ’¤é”€/é‡åšåŠŸèƒ½
- æ“ä½œå†å²è®°å½•
- ä»»åŠ¡é˜Ÿåˆ—ã€æ‰¹å¤„ç†
- äº‹åŠ¡ç®¡ç†
- å®å‘½ä»¤ï¼ˆç»„åˆå¤šä¸ªæ“ä½œï¼‰

#### âŒ ä¸é€‚åˆä½¿ç”¨çš„åœºæ™¯

- ç®€å•çš„ CRUD æ“ä½œ
- ä¸éœ€è¦æ’¤é”€çš„æ“ä½œ
- å†…å­˜æ•æ„Ÿçš„åœºæ™¯

---

## çŠ¶æ€æ¨¡å¼

### ğŸ’¡ æ¨¡å¼å®šä¹‰
çŠ¶æ€æ¨¡å¼ï¼ˆState Patternï¼‰å…è®¸å¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å…¶è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥å¥½åƒä¿®æ”¹äº†å®ƒçš„ç±»ã€‚

### ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€æ¨¡å¼ï¼Ÿ

#### é—®é¢˜åœºæ™¯ï¼šè®¢å•çŠ¶æ€ã€æ’­æ”¾å™¨çŠ¶æ€ã€æµç¨‹æ§åˆ¶

å‡è®¾ä½ åœ¨å¼€å‘ä¸€ä¸ªéŸ³ä¹æ’­æ”¾å™¨ï¼š

#### âŒ ä¸ä½¿ç”¨çŠ¶æ€æ¨¡å¼çš„ç—›ç‚¹

```javascript
// MusicPlayer.jsx - å……æ»¡çŠ¶æ€åˆ¤æ–­
function MusicPlayer({ track }) {
  const [state, setState] = React.useState('stopped'); // stopped, playing, paused
  const audioRef = React.useRef(new Audio(track.url));

  const handlePlay = () => {
    // æ ¹æ®å½“å‰çŠ¶æ€åˆ¤æ–­èƒ½å¦æ’­æ”¾
    if (state === 'stopped') {
      audioRef.current.play();
      setState('playing');
    } else if (state === 'paused') {
      audioRef.current.play();
      setState('playing');
    } else if (state === 'playing') {
      // å·²ç»åœ¨æ’­æ”¾ï¼Œä»€ä¹ˆéƒ½ä¸åš
      console.log('Already playing');
    }
  };

  const handlePause = () => {
    if (state === 'playing') {
      audioRef.current.pause();
      setState('paused');
    } else if (state === 'stopped') {
      // åœæ­¢çŠ¶æ€ä¸èƒ½æš‚åœ
      console.log('Cannot pause when stopped');
    } else if (state === 'paused') {
      // å·²ç»æš‚åœ
      console.log('Already paused');
    }
  };

  const handleStop = () => {
    if (state === 'playing' || state === 'paused') {
      audioRef.current.pause();
      audioRef.current.currentTime = 0;
      setState('stopped');
    } else if (state === 'stopped') {
      console.log('Already stopped');
    }
  };

  const handleNext = () => {
    if (state === 'playing') {
      // æ’­æ”¾ä¸­å¯ä»¥åˆ‡æ¢
      audioRef.current.pause();
      // åŠ è½½ä¸‹ä¸€é¦–
      setState('playing');
    } else if (state === 'paused') {
      // æš‚åœæ—¶ä¹Ÿå¯ä»¥åˆ‡æ¢
      // åŠ è½½ä¸‹ä¸€é¦–
      setState('paused');
    } else if (state === 'stopped') {
      // åœæ­¢æ—¶åˆ‡æ¢ä½†ä¸æ’­æ”¾
      // åŠ è½½ä¸‹ä¸€é¦–
      setState('stopped');
    }
  };

  // æ¯ä¸ªæ“ä½œéƒ½è¦åˆ¤æ–­æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€ï¼
  // æ–°å¢çŠ¶æ€ï¼ˆå¦‚ buffering, errorï¼‰ä¼šå¯¼è‡´å¤§é‡ä¿®æ”¹

  return (
    <div className="music-player">
      <p>çŠ¶æ€: {state}</p>
      <button onClick={handlePlay}>æ’­æ”¾</button>
      <button onClick={handlePause}>æš‚åœ</button>
      <button onClick={handleStop}>åœæ­¢</button>
      <button onClick={handleNext}>ä¸‹ä¸€é¦–</button>
    </div>
  );
}
```

**é—®é¢˜**ï¼š
- çŠ¶æ€åˆ¤æ–­åˆ†æ•£ï¼šæ¯ä¸ªæ–¹æ³•éƒ½è¦åˆ¤æ–­æ‰€æœ‰çŠ¶æ€
- éš¾ä»¥æ‰©å±•ï¼šæ–°å¢çŠ¶æ€éœ€è¦ä¿®æ”¹æ‰€æœ‰æ–¹æ³•
- ä»£ç é‡å¤ï¼šç›¸ä¼¼çš„çŠ¶æ€åˆ¤æ–­é€»è¾‘
- çŠ¶æ€è½¬æ¢ä¸æ¸…æ™°ï¼šä¸çŸ¥é“å“ªäº›çŠ¶æ€å¯ä»¥äº’ç›¸è½¬æ¢

---

#### âœ… ä½¿ç”¨çŠ¶æ€æ¨¡å¼è§£å†³

```javascript
// states/PlayerState.js - çŠ¶æ€åŸºç±»
class PlayerState {
  constructor(player) {
    this.player = player;
  }

  play() {
    console.log('Cannot play in this state');
  }

  pause() {
    console.log('Cannot pause in this state');
  }

  stop() {
    console.log('Cannot stop in this state');
  }

  next() {
    console.log('Cannot switch track in this state');
  }

  getName() {
    return this.constructor.name;
  }
}

export default PlayerState;
```

```javascript
// states/StoppedState.js
import PlayerState from './PlayerState';

class StoppedState extends PlayerState {
  play() {
    console.log('Starting playback...');
    this.player.audio.play();
    this.player.setState(this.player.states.playing);
  }

  pause() {
    console.log('Cannot pause when stopped');
  }

  stop() {
    console.log('Already stopped');
  }

  next() {
    console.log('Switching to next track (stopped)');
    this.player.loadNextTrack();
    // ä¿æŒåœæ­¢çŠ¶æ€
  }
}

export default StoppedState;
```

```javascript
// states/PlayingState.js
import PlayerState from './PlayerState';

class PlayingState extends PlayerState {
  play() {
    console.log('Already playing');
  }

  pause() {
    console.log('Pausing playback...');
    this.player.audio.pause();
    this.player.setState(this.player.states.paused);
  }

  stop() {
    console.log('Stopping playback...');
    this.player.audio.pause();
    this.player.audio.currentTime = 0;
    this.player.setState(this.player.states.stopped);
  }

  next() {
    console.log('Switching to next track (playing)');
    this.player.loadNextTrack();
    this.player.audio.play();
    // ä¿æŒæ’­æ”¾çŠ¶æ€
  }
}

export default PlayingState;
```

```javascript
// states/PausedState.js
import PlayerState from './PlayerState';

class PausedState extends PlayerState {
  play() {
    console.log('Resuming playback...');
    this.player.audio.play();
    this.player.setState(this.player.states.playing);
  }

  pause() {
    console.log('Already paused');
  }

  stop() {
    console.log('Stopping playback...');
    this.player.audio.currentTime = 0;
    this.player.setState(this.player.states.stopped);
  }

  next() {
    console.log('Switching to next track (paused)');
    this.player.loadNextTrack();
    // ä¿æŒæš‚åœçŠ¶æ€
  }
}

export default PausedState;
```

```javascript
// MusicPlayer.js - æ’­æ”¾å™¨ç±»
import StoppedState from './states/StoppedState';
import PlayingState from './states/PlayingState';
import PausedState from './states/PausedState';

class MusicPlayer {
  constructor(track) {
    this.audio = new Audio(track.url);
    this.currentTrack = track;

    // åˆ›å»ºæ‰€æœ‰çŠ¶æ€å®ä¾‹
    this.states = {
      stopped: new StoppedState(this),
      playing: new PlayingState(this),
      paused: new PausedState(this),
    };

    // åˆå§‹çŠ¶æ€
    this.currentState = this.states.stopped;
    this.listeners = [];
  }

  // è®¾ç½®çŠ¶æ€
  setState(state) {
    console.log(`State: ${this.currentState.getName()} -> ${state.getName()}`);
    this.currentState = state;
    this.notifyListeners();
  }

  // æ“ä½œæ–¹æ³•ï¼ˆå§”æ‰˜ç»™å½“å‰çŠ¶æ€ï¼‰
  play() {
    this.currentState.play();
  }

  pause() {
    this.currentState.pause();
  }

  stop() {
    this.currentState.stop();
  }

  next() {
    this.currentState.next();
  }

  loadNextTrack() {
    // åŠ è½½ä¸‹ä¸€é¦–æ­Œ
    console.log('Loading next track...');
  }

  getState() {
    return this.currentState.getName();
  }

  // è§‚å¯Ÿè€…æ¨¡å¼ï¼šé€šçŸ¥çŠ¶æ€å˜åŒ–
  subscribe(listener) {
    this.listeners.push(listener);
    return () => {
      this.listeners = this.listeners.filter(l => l !== listener);
    };
  }

  notifyListeners() {
    this.listeners.forEach(listener => listener(this.getState()));
  }
}

export default MusicPlayer;
```

```javascript
// MusicPlayerUI.jsx - React ç»„ä»¶
import React from 'react';
import MusicPlayer from './MusicPlayer';

function MusicPlayerUI({ track }) {
  const [state, setState] = React.useState('StoppedState');
  const playerRef = React.useRef(null);

  React.useEffect(() => {
    const player = new MusicPlayer(track);
    playerRef.current = player;

    // è®¢é˜…çŠ¶æ€å˜åŒ–
    const unsubscribe = player.subscribe(setState);

    return () => {
      unsubscribe();
    };
  }, [track]);

  const handlePlay = () => playerRef.current?.play();
  const handlePause = () => playerRef.current?.pause();
  const handleStop = () => playerRef.current?.stop();
  const handleNext = () => playerRef.current?.next();

  return (
    <div className="music-player">
      <p>å½“å‰çŠ¶æ€: {state}</p>
      <div className="controls">
        <button onClick={handlePlay}>â–¶ï¸ æ’­æ”¾</button>
        <button onClick={handlePause}>â¸ï¸ æš‚åœ</button>
        <button onClick={handleStop}>â¹ï¸ åœæ­¢</button>
        <button onClick={handleNext}>â­ï¸ ä¸‹ä¸€é¦–</button>
      </div>
    </div>
  );
}

export default MusicPlayerUI;
```

**æ•ˆæœ**ï¼š
- âœ… çŠ¶æ€é€»è¾‘é›†ä¸­ï¼šæ¯ä¸ªçŠ¶æ€ç±»åªå¤„ç†è‡ªå·±çš„é€»è¾‘
- âœ… æ˜“äºæ‰©å±•ï¼šæ–°å¢çŠ¶æ€åªéœ€æ·»åŠ æ–°ç±»
- âœ… çŠ¶æ€è½¬æ¢æ¸…æ™°ï¼šä¸€ç›®äº†ç„¶
- âœ… æ¶ˆé™¤æ¡ä»¶è¯­å¥ï¼šæ²¡æœ‰ if-else

---

### ğŸ—ï¸ çœŸå®ä¸šåŠ¡åœºæ™¯

#### åœºæ™¯1ï¼šè®¢å•çŠ¶æ€æœº

```javascript
// states/OrderState.js
class OrderState {
  constructor(order) {
    this.order = order;
  }

  pay() {
    throw new Error('Cannot pay in this state');
  }

  ship() {
    throw new Error('Cannot ship in this state');
  }

  deliver() {
    throw new Error('Cannot deliver in this state');
  }

  cancel() {
    throw new Error('Cannot cancel in this state');
  }

  getName() {
    return this.constructor.name;
  }
}

// å¾…æ”¯ä»˜çŠ¶æ€
class PendingPaymentState extends OrderState {
  pay() {
    console.log('Processing payment...');
    // æ”¯ä»˜é€»è¾‘
    this.order.setState(this.order.states.paid);
  }

  cancel() {
    console.log('Cancelling order...');
    this.order.setState(this.order.states.cancelled);
  }
}

// å·²æ”¯ä»˜çŠ¶æ€
class PaidState extends OrderState {
  ship() {
    console.log('Shipping order...');
    this.order.setState(this.order.states.shipped);
  }

  cancel() {
    console.log('Cancelling and refunding...');
    // é€€æ¬¾é€»è¾‘
    this.order.setState(this.order.states.cancelled);
  }
}

// å·²å‘è´§çŠ¶æ€
class ShippedState extends OrderState {
  deliver() {
    console.log('Order delivered!');
    this.order.setState(this.order.states.delivered);
  }
}

// å·²å®ŒæˆçŠ¶æ€
class DeliveredState extends OrderState {
  // å·²å®Œæˆï¼Œä¸èƒ½å†æ“ä½œ
}

// å·²å–æ¶ˆçŠ¶æ€
class CancelledState extends OrderState {
  // å·²å–æ¶ˆï¼Œä¸èƒ½å†æ“ä½œ
}

// Order.js
class Order {
  constructor(orderId) {
    this.orderId = orderId;

    this.states = {
      pendingPayment: new PendingPaymentState(this),
      paid: new PaidState(this),
      shipped: new ShippedState(this),
      delivered: new DeliveredState(this),
      cancelled: new CancelledState(this),
    };

    this.currentState = this.states.pendingPayment;
  }

  setState(state) {
    console.log(`Order ${this.orderId}: ${this.currentState.getName()} -> ${state.getName()}`);
    this.currentState = state;
  }

  pay() {
    this.currentState.pay();
  }

  ship() {
    this.currentState.ship();
  }

  deliver() {
    this.currentState.deliver();
  }

  cancel() {
    this.currentState.cancel();
  }

  getStatus() {
    return this.currentState.getName();
  }
}

export default Order;
```

```javascript
// ä½¿ç”¨è®¢å•çŠ¶æ€æœº
const order = new Order('ORDER-123');

console.log(order.getStatus()); // PendingPaymentState

order.pay(); // æ”¯ä»˜æˆåŠŸ -> PaidState
order.ship(); // å‘è´§ -> ShippedState
order.deliver(); // é€è¾¾ -> DeliveredState

// order.cancel(); // æŠ¥é”™ï¼šCannot cancel in this state
```

#### åœºæ™¯2ï¼šTCP è¿æ¥çŠ¶æ€

```javascript
// Connection.js - TCP è¿æ¥çŠ¶æ€æœº
class ConnectionState {
  constructor(connection) {
    this.connection = connection;
  }

  open() {}
  close() {}
  send(data) {}
  receive(data) {}
}

class ClosedState extends ConnectionState {
  open() {
    console.log('Opening connection...');
    this.connection.socket.connect();
    this.connection.setState(this.connection.states.connecting);
  }

  close() {
    console.log('Already closed');
  }

  send(data) {
    throw new Error('Cannot send data when connection is closed');
  }
}

class ConnectingState extends ConnectionState {
  open() {
    console.log('Already connecting');
  }

  close() {
    console.log('Aborting connection...');
    this.connection.socket.abort();
    this.connection.setState(this.connection.states.closed);
  }

  send(data) {
    throw new Error('Cannot send data while connecting');
  }
}

class ConnectedState extends ConnectionState {
  open() {
    console.log('Already connected');
  }

  close() {
    console.log('Closing connection...');
    this.connection.socket.close();
    this.connection.setState(this.connection.states.closed);
  }

  send(data) {
    console.log('Sending data:', data);
    this.connection.socket.send(data);
  }

  receive(data) {
    console.log('Received data:', data);
    this.connection.onData(data);
  }
}

class Connection {
  constructor() {
    this.socket = null;

    this.states = {
      closed: new ClosedState(this),
      connecting: new ConnectingState(this),
      connected: new ConnectedState(this),
    };

    this.currentState = this.states.closed;
  }

  setState(state) {
    this.currentState = state;
  }

  open() {
    this.currentState.open();
  }

  close() {
    this.currentState.close();
  }

  send(data) {
    this.currentState.send(data);
  }

  receive(data) {
    this.currentState.receive(data);
  }

  onData(data) {
    // å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®
  }
}
```

---

### ğŸ¨ åœ¨ä¸»æµæ¡†æ¶ä¸­çš„åº”ç”¨

#### Promise çŠ¶æ€

```javascript
// Promise æœ‰ä¸‰ä¸ªçŠ¶æ€ï¼špending, fulfilled, rejected
const promise = new Promise((resolve, reject) => {
  // pending çŠ¶æ€
  setTimeout(() => {
    resolve('success'); // è½¬æ¢åˆ° fulfilled çŠ¶æ€
  }, 1000);
});

promise.then(
  value => console.log(value), // fulfilled çŠ¶æ€
  error => console.error(error) // rejected çŠ¶æ€
);
```

#### React ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ

```javascript
class MyComponent extends React.Component {
  // Mounting çŠ¶æ€
  componentDidMount() {}

  // Updating çŠ¶æ€
  componentDidUpdate() {}

  // Unmounting çŠ¶æ€
  componentWillUnmount() {}
}
```

---

### âš–ï¸ ä¼˜ç¼ºç‚¹åˆ†æ

#### âœ… ä¼˜ç‚¹

1. **æ¶ˆé™¤æ¡ä»¶è¯­å¥**ï¼šé¿å…å¤§é‡ if-else
2. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªçŠ¶æ€ç±»åªå¤„ç†ä¸€ä¸ªçŠ¶æ€
3. **çŠ¶æ€è½¬æ¢æ¸…æ™°**ï¼šä¸€ç›®äº†ç„¶
4. **æ˜“äºæ‰©å±•**ï¼šæ·»åŠ æ–°çŠ¶æ€ä¸å½±å“ç°æœ‰çŠ¶æ€

#### âŒ ç¼ºç‚¹

1. **ç±»æ•°é‡å¢åŠ **ï¼šæ¯ä¸ªçŠ¶æ€éƒ½æ˜¯ä¸€ä¸ªç±»
2. **çŠ¶æ€è¿‡å¤šæ—¶å¤æ‚**ï¼šçŠ¶æ€å¾ˆå¤šæ—¶éš¾ä»¥ç®¡ç†
3. **çŠ¶æ€å…±äº«å›°éš¾**ï¼šçŠ¶æ€ä¹‹é—´å…±äº«æ•°æ®éœ€è¦é€šè¿‡ä¸Šä¸‹æ–‡å¯¹è±¡

---

### ğŸ“‹ ä½•æ—¶ä½¿ç”¨çŠ¶æ€æ¨¡å¼

#### âœ… é€‚åˆä½¿ç”¨çš„åœºæ™¯

- å¯¹è±¡è¡Œä¸ºéšçŠ¶æ€æ”¹å˜è€Œæ”¹å˜
- å¤§é‡æ¡ä»¶è¯­å¥ï¼ˆif-else, switchï¼‰
- çŠ¶æ€è½¬æ¢è§„åˆ™æ˜ç¡®
- çŠ¶æ€æœºã€å·¥ä½œæµ

#### âŒ ä¸é€‚åˆä½¿ç”¨çš„åœºæ™¯

- åªæœ‰ 2-3 ä¸ªçŠ¶æ€
- çŠ¶æ€è½¬æ¢ç®€å•
- çŠ¶æ€ä¹‹é—´æœ‰å¤§é‡å…±äº«é€»è¾‘

---

## ğŸ“ æ€»ç»“

### è¡Œä¸ºå‹æ¨¡å¼å¯¹æ¯”

| æ¨¡å¼ | æ ¸å¿ƒç›®çš„ | ä½¿ç”¨åœºæ™¯ | ä¼˜å…ˆçº§ |
|-----|---------|---------|-------|
| **è§‚å¯Ÿè€…æ¨¡å¼** | å¯¹è±¡é—´ä¸€å¯¹å¤šä¾èµ– | äº‹ä»¶ç³»ç»Ÿã€çŠ¶æ€è®¢é˜… | â­â­â­â­â­ |
| **ç­–ç•¥æ¨¡å¼** | ç®—æ³•å¯æ›¿æ¢ | è¡¨å•éªŒè¯ã€æ”¯ä»˜æ–¹å¼ | â­â­â­â­â­ |
| **å‘½ä»¤æ¨¡å¼** | è¯·æ±‚å°è£…æˆå¯¹è±¡ | æ’¤é”€é‡åšã€ä»»åŠ¡é˜Ÿåˆ— | â­â­â­â­ |
| **çŠ¶æ€æ¨¡å¼** | çŠ¶æ€æ”¹å˜è¡Œä¸º | çŠ¶æ€æœºã€æµç¨‹æ§åˆ¶ | â­â­â­â­ |

### å­¦ä¹ å»ºè®®

1. **è§‚å¯Ÿè€…æ¨¡å¼**ï¼šå‰ç«¯æœ€å¸¸ç”¨ï¼ŒæŒæ¡ EventEmitter å’Œ React Context
2. **ç­–ç•¥æ¨¡å¼**ï¼šç†è§£å¦‚ä½•æ¶ˆé™¤ if-elseï¼Œæå‡ä»£ç è´¨é‡
3. **å‘½ä»¤æ¨¡å¼**ï¼šç†è§£æ’¤é”€/é‡åšçš„å®ç°åŸç†
4. **çŠ¶æ€æ¨¡å¼**ï¼šå­¦ä¼šç”¨çŠ¶æ€æœºå¤„ç†å¤æ‚æµç¨‹

### æ¨¡å¼ç»„åˆä½¿ç”¨

åœ¨å®é™…å¼€å‘ä¸­ï¼Œè¿™äº›æ¨¡å¼ç»å¸¸ç»„åˆä½¿ç”¨ï¼š

- **è§‚å¯Ÿè€… + å‘½ä»¤**ï¼šå‘½ä»¤æ‰§è¡Œåé€šçŸ¥è§‚å¯Ÿè€…
- **ç­–ç•¥ + å·¥å‚**ï¼šä½¿ç”¨å·¥å‚åˆ›å»ºç­–ç•¥å¯¹è±¡
- **çŠ¶æ€ + å‘½ä»¤**ï¼šçŠ¶æ€è½¬æ¢é€šè¿‡å‘½ä»¤å®ç°

---

**ä¸‹ä¸€æ­¥**ï¼šç»§ç»­å­¦ä¹  [å‰ç«¯æ¶æ„æ¨¡å¼](./04-å‰ç«¯æ¶æ„æ¨¡å¼.md)ï¼Œå­¦ä¹ å¤§å‹åº”ç”¨çš„æ¶æ„è®¾è®¡ã€‚

ğŸ‰ æ­å–œå®Œæˆè¡Œä¸ºå‹æ¨¡å¼çš„å­¦ä¹ ï¼
